{"version":3,"sources":["node_modules/browser-pack/_prelude.js","index.js","lib/utils.js","node_modules/async/lib/async.js","node_modules/browserify/node_modules/process/browser.js","node_modules/for-each/index.js","node_modules/global/window.js","node_modules/is-function/index.js","node_modules/object-assign/index.js","node_modules/parse-headers/parse-headers.js","node_modules/query-string/index.js","node_modules/strict-uri-encode/index.js","node_modules/trim/index.js","node_modules/url-set-query/index.js","node_modules/xhr-request/index.js","node_modules/xhr-request/lib/ensure-header.js","node_modules/xhr-request/lib/normalize-response.js","node_modules/xhr-request/lib/request-browser.js","node_modules/xhr/index.js","node_modules/xtend/immutable.js"],"names":["singlePage","server","layer","req","join","findMinAndMax","statResponse","attributes","features","values","Object","keys","map","key","minMax","min","max","queue","require","Utils","FeatureService","url","options","this","service","parseUrl","hosted","sanitizeLayer","size","backoff","timeOut","logger","_request","pageQueue","_requestFeatures","bind","concurrency","prototype","log","level","message","_console","console","info","warn","error","request","callback","json","encoded","encodeURI","decodeURI","timeout","headers","user-agent","err","data","res","code","JSON","parse","pattern","RegExp","slice","match","Error","_statsUrl","field","stats","objectIdField","forEach","stat","push","statisticType","onStatisticField","outStatisticFieldName","stringify","statistics","timestamp","Date","body","_info","layerInfo","_layerInfo","getObjectIdField","oid","fields","some","type","name","layerIds","objectIds","sort","a","b","featureCount","countUrl","metadata","_metadata","maxRecordCount","currentVersion","count","pages","meta","setConcurrency","geometryType","maxConcurrency","Math","parseInt","nPages","ceil","canPage","advancedQueryCapabilities","supportsPagination","_offsetPages","supportsStatistics","getObjectIdRange","ids","_idPages","_rangePages","oidField","eMsg","e","resultOffset","reqs","i","pageUrl","length","pageIds","splice","pageMin","pageMax","pop","where","objId","task","cb","self","_catchErrors","_throttleQueue","retry","_abortPaging","setTimeout","fail","floor","kill","module","exports","geomType","naieve","undefined","test","raw","noop","identity","v","toBool","notId","only_once","fn","apply","arguments","_once","_isArrayLike","arr","_isArray","_arrayEach","iterator","index","_map","result","Array","_range","_reduce","memo","x","_forEachOf","object","_keys","_indexOf","item","_keyIterator","coll","len","_restParam","func","startIndex","rest","call","_withoutIndex","value","_eachOfLimit","limit","obj","nextKey","done","running","errored","replenish","doParallel","async","eachOf","doParallelLimit","doSeries","eachOfSeries","_asyncMap","eachfn","results","_filter","_reject","_createTester","check","getResult","iteratee","_","_findGetResult","_parallel","tasks","args","_concat","y","concat","_queue","worker","payload","_insert","q","pos","started","idle","setImmediate","drain","unshift","saturated","process","_next","workers","removed","workersList","empty","paused","pause","resume","resumeCount","w","_console_fn","_times","mapper","_applyEach","fns","go","that","ensureAsync","innerArgs","sync","previous_async","root","global","noConflict","_toString","toString","isArray","_isObject","k","hasOwnProperty","_setImmediate","_delay","nextTick","each","forEachSeries","eachSeries","forEachLimit","eachLimit","forEachOf","completed","iter","forEachOfSeries","iterate","forEachOfLimit","eachOfLimit","mapSeries","mapLimit","inject","foldl","reduce","foldr","reduceRight","reversed","reverse","transform","select","filter","selectLimit","filterLimit","selectSeries","filterSeries","reject","rejectLimit","rejectSeries","any","someLimit","all","every","everyLimit","detect","detectSeries","detectLimit","sortBy","comparator","left","right","criteria","auto","addListener","listeners","removeListener","idx","taskComplete","remainingTasks","runningTasks","hasError","ready","requires","listener","taskCallback","dep","safeResults","val","rkey","times","parseTimes","acc","t","DEFAULT_TIMES","interval","DEFAULT_INTERVAL","wrappedTask","wrappedCallback","wrappedResults","retryAttempt","finalAttempt","seriesCallback","retryInterval","opts","attempts","series","waterfall","wrapIterator","next","parallel","parallelLimit","makeCallback","callArgs","concatSeries","whilst","doWhilst","calls","until","doUntil","during","truth","doDuring","items","priorityQueue","_compareTasks","priority","_binarySearch","sequence","compare","beg","end","mid","cargo","dir","memoize","hasher","queues","has","memoized","l","unmemoized","unmemoize","timesSeries","timesLimit","seq","newargs","nextargs","compose","applyEach","applyEachSeries","forever","constant","wrapSync","asyncify","then","define","amd","defaultSetTimout","defaultClearTimeout","runTimeout","fun","cachedSetTimeout","runClearTimeout","marker","cachedClearTimeout","clearTimeout","cleanUpNextTick","draining","currentQueue","queueIndex","drainQueue","run","Item","array","title","browser","env","argv","version","versions","on","once","off","removeAllListeners","emit","binding","cwd","chdir","umask","list","context","isFunction","TypeError","forEachArray","forEachString","forEachObject","string","charAt","window","alert","confirm","prompt","ToObject","ownEnumerableKeys","getOwnPropertyNames","getOwnPropertySymbols","propIsEnumerable","propertyIsEnumerable","assign","target","source","from","to","s","trim","arg","split","row","indexOf","toLowerCase","strictUriEncode","extract","str","replace","ret","param","parts","shift","decodeURIComponent","val2","encodeURIComponent","c","charCodeAt","toUpperCase","urlSetQuery","query","start","xhrRequest","opt","defaultResponse","responseType","method","queryString","setQuery","ensureHeader","mimeTypeJson","lower","getResponse","resp","statusCode","rawRequest","uri","useJson","xhr","text","responseText","normalize","isEmpty","initParams","params","xtend","createXHR","_createXHR","readystatechange","readyState","loadFunc","getBody","response","getXml","isJson","errorFunc","evt","timeoutTimer","failureResponse","aborted","status","useXDR","getAllResponseHeaders","parseHeaders","called","cors","XDomainRequest","XMLHttpRequest","onreadystatechange","onload","onerror","onprogress","ontimeout","open","username","password","withCredentials","abort","setRequestHeader","beforeSend","send","responseXML","firefoxBugTakenEffect","documentElement","nodeName","extend"],"mappings":"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","file":"bundle.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","var queue = require('async').queue\nvar Utils = require('./lib/utils.js')\n\n/**\n * Feature Service constructor. Requires a URL.\n * Exposes a pageQueue that can take an array of page URLs.\n * The pageQueue will report back each page of features as they return.\n *\n * @class\n * @param {string} url - address of feature service\n * @param {object} options - layer (default: 0)\n */\nvar FeatureService = function (url, options) {\n  // catch omission of `new` keyword\n  if (!(this instanceof FeatureService)) {\n    return new FeatureService(url, options)\n  }\n  var service = Utils.parseUrl(url)\n  this.hosted = service.hosted\n  this.server = service.server\n  this.options = options || {}\n  if (this.options.layer || this.options.layer === 0) this.options.layer = Utils.sanitizeLayer(this.options.layer)\n  this.options.size = this.options.size || 5000\n  this.options.backoff = this.options.backoff || 1000\n  this.options.timeOut = this.options.timeOut || (1.5 * 60 * 1000)\n  this.layer = this.options.layer || service.layer || 0\n\n  this.logger = this.options.logger\n\n  this._request = require('xhr-request')\n\n  // an async for requesting pages of data\n  this.pageQueue = queue(this._requestFeatures.bind(this), this.options.concurrency || 4)\n}\n\n/**\n * Wraps logging functionality so a logger can be passed in\n *\n * @param {string} level - the log level to use\n * @param {string} message - the message to log\n */\nFeatureService.prototype.log = function (level, message) {\n  if (this.logger && this.logger.log) return this.logger.log(level, message)\n  this._console(level, message)\n}\n\n/**\n * Wraps console logging to make it testable\n *\n * @param {string} level - the log level to use\n * @param {string} message - the message to log\n */\nFeatureService.prototype._console = function (level, message) {\n  switch (level) {\n    case 'info':\n      console.info(message)\n      break\n    case 'warn':\n      console.warn(message)\n      break\n    case 'error':\n      console.error(message)\n      break\n    default:\n      console.log(message)\n  }\n}\n\n/**\n * Wrap the request.get method for easier testing\n * @param {string} url\n * @param {function} callback\n */\n // TODO combine this with _requestFeatures\nFeatureService.prototype.request = function (url, callback) {\n  var json\n  // to ensure things are encoded just right for ArcGIS\n  var encoded = encodeURI(decodeURI(url))\n  var options = {\n    timeout: this.options.timeOut,\n    headers: {\n      'user-agent': 'Featureservices-Node'\n    }\n\n  }\n  this._request(encoded, options, function (err, data, res) {\n    if (err) {\n      if (err.code === 'ESOCKETTIMEDOUT') err.code = 504\n      return callback(err)\n    }\n    try {\n      json = JSON.parse(data)\n    } catch (err) {\n      // sometimes we get html or plain strings back\n      var pattern = new RegExp(/[^{\\[]/)\n      if (data.slice(0, 1).match(pattern)) {\n        return callback(new Error('Received HTML or plain text when expecting JSON'))\n      }\n      return callback(new Error('Failed to parse server response'))\n    }\n    callback(null, json)\n  })\n}\n\n/**\n * Builds a url for querying the min/max values of the object id\n *\n * @param {string} field - the name of a field to build a stat request for\n * @returns {string} url\n */\nFeatureService.prototype._statsUrl = function (field, stats) {\n  field = field || this.options.objectIdField\n  var json = []\n\n  stats.forEach(function (stat) {\n    json.push({\n      'statisticType': stat,\n      'onStatisticField': field,\n      'outStatisticFieldName': stat + '_' + field\n    })\n  })\n\n  return this.server + '/' + this.layer + '/query?f=json&outFields=&outStatistics=' + JSON.stringify(json)\n}\n\n/**\n * Gets the feature service info\n * @param {string} field - the name of a field to build a stat request for\n * @param {array} stats - an array of stats to request: ['min', 'max', 'avg', 'stddev', 'count']\n */\nFeatureService.prototype.statistics = function (field, stats, callback) {\n  var url = this._statsUrl(field, stats)\n  this.request(url, function (err, json) {\n    if (err || json.error) {\n      if (!json) json = {error: {}}\n      var error = new Error('Request for statistics failed')\n      error.timestamp = new Date()\n      error.code = json.error.code || 500\n      error.body = err || json.error\n      error.url = url\n      return callback(error)\n    }\n    callback(null, json)\n  })\n}\n\n/**\n * Gets the feature service info\n * @param {function} callback - called when the service info comes back\n */\nFeatureService.prototype.info = function (callback) {\n  if (typeof callback === 'undefined') return this._info\n  if (this._info) return callback(null, this._info)\n  var url = this.server + '?f=json'\n  this.request(url, function (err, json) {\n    /**\n     * returns error on three conditions:\n     * 1. err is present\n     * 2. missing response json\n     * 3. error in response json\n     */\n    if (err || !json || json.error) {\n      if (!json) json = {error: {}}\n      var error = new Error('Request for service information failed')\n      error.timestamp = new Date()\n      error.url = url\n      error.code = json.error.code || 500\n      error.body = json.error\n\n      return callback(error)\n    }\n    this._info = json\n    json.url = url\n    callback(null, json)\n  })\n}\n\n/**\n * Gets the feature service layer info\n * @param {function} callback - called when the layer info comes back\n */\nFeatureService.prototype.layerInfo = function (callback) {\n  // used saved version if available\n  if (typeof callback === 'undefined') return this._layerInfo\n  if (this._layerInfo) return callback(null, this._layerInfo)\n\n  var url = this.server + '/' + this.layer + '?f=json'\n\n  this.request(url, function (err, json) {\n    /**\n     * returns error on three conditions:\n     * 1. err is present\n     * 2. missing response json\n     * 3. error in response json\n     */\n    if (err || !json || json.error) {\n      if (!json) json = {error: {}}\n      var error = new Error('Request for layer information failed')\n      error.timestamp = new Date()\n      error.url = url\n      error.code = json.error.code || 500\n      error.body = json.error\n\n      return callback(error)\n    }\n\n    json.url = url\n    callback(null, json)\n  })\n}\n\n/**\n * Gets the objectID field from the service info\n @param {object} info the feature layer metadata\n @returns {string} service's object id field\n*/\nFeatureService.prototype.getObjectIdField = function (info) {\n  var oid\n  if (!info.fields) return false\n  if (info.objectIdField) return info.objectIdField\n  info.fields.some(function (field) {\n    if (field.type === 'esriFieldTypeOID') {\n      oid = field.name\n      return true\n    }\n  })\n\n  return oid\n}\n\n/**\n * Gets the feature service object ids for pagination\n * @param {object} callback - called when the service info comes back\n */\nFeatureService.prototype.layerIds = function (callback) {\n  var url = this.server + '/' + this.layer + '/query?where=1=1&returnIdsOnly=true&f=json'\n  this.request(url, function (err, json) {\n    if (err || !json.objectIds) {\n      if (!json) json = {error: {}}\n      var error = new Error('Request for object IDs failed')\n      error.timestamp = new Date()\n      error.code = json.error.code || 500\n      error.url = url\n      error.body = err || json.error\n\n      return callback(error)\n    }\n    // TODO: is this really necessary\n    json.objectIds.sort(function (a, b) { return a - b })\n    callback(null, json.objectIds)\n  })\n}\n\n/**\n * Count of every single feature in the service\n * @param {object} callback - called when the service info comes back\n */\nFeatureService.prototype.featureCount = function (callback) {\n  var countUrl = this.server + '/' + (this.layer || 0)\n  countUrl += '/query?where=1=1&returnCountOnly=true&f=json'\n\n  this.request(countUrl, function (err, json) {\n    if (err || json.error) {\n      // init empty json error so we can handle building the error in one logic stream\n      if (!json) json = {error: {}}\n      var error = new Error('Request for feature count failed')\n      error.timestamp = new Date()\n      error.code = json.error.code || 500\n      error.url = countUrl\n      error.body = err || json.error\n\n      return callback(error)\n    }\n\n    callback(null, json)\n  })\n}\n\n/**\n * Gets and derives layer metadata from two sources\n * @param {function} callback - called with an error or a metadata object\n */\nFeatureService.prototype.metadata = function (callback) {\n  if (typeof callback === 'undefined') return this._metadata\n  if (this._metadata) return callback(null, this._metadata)\n\n  this.layerInfo(function (err, layer) {\n    if (err) {\n      err.message = 'Unable to get layer metadata: ' + err.message\n      return callback(err)\n    }\n    this._layerInfo = layer\n    var oid = this.getObjectIdField(layer)\n    var size = layer.maxRecordCount\n\n    // TODO flatten this\n    var metadata = {layer: layer, oid: oid, size: size}\n\n    // 10.0 servers don't support count requests\n    // they also do not show current version on the layer\n    if (!layer.currentVersion) return callback(null, metadata)\n\n    this.featureCount(function (err, json) {\n      if (err) return callback(err)\n      if (json.count < 1) return callback(new Error('Service returned count of 0'))\n      metadata.count = json.count\n      this._metadata = metadata\n      callback(null, metadata)\n    })\n  }.bind(this))\n}\n\n/**\n * Build an array pages that will cover every feature in the service\n * @param {object} callback - called when the service info comes back\n */\nFeatureService.prototype.pages = function (callback) {\n  this.metadata(function (err, meta) {\n    if (err) return callback(err)\n    if (meta.count < meta.layer.maxRecordCount && meta.count < this.options.size) return callback(null, singlePage(this.server, this.layer))\n    this.concurrency = this.options.concurrency || Utils.setConcurrency(this.hosted, meta.layer.geometryType)\n    this.maxConcurrency = this.concurrency\n    this.pageQueue.concurrency = this.concurrency\n    var size = Math.min(parseInt(meta.size, 10), 1000) || 1000\n    // restrict page size to the passed in maximum\n    if (size > 5000) size = this.options.size\n\n    var layer = meta.layer\n    var nPages = Math.ceil(meta.count / size)\n\n    // if the service supports paging, we can use offset to build pages\n    var canPage = layer.advancedQueryCapabilities && layer.advancedQueryCapabilities.supportsPagination\n    if (canPage && this.hosted) return callback(null, this._offsetPages(nPages, size))\n\n    if (!meta.oid) return callback(new Error('ObjectID type field not found, unable to page'))\n    this.options.objectIdField = meta.oid\n    // if the service supports statistics, we can request the maximum and minimum id to build pages\n    if (layer.supportsStatistics) {\n      this.getObjectIdRange(meta.oid, function (err, stats) {\n      // if this worked then we can pagination using where clauses\n        if (!err) return callback(null, this._rangePages(stats, size))\n        // if it failed, try to request all the ids and split them into pages\n        this.layerIds(function (err, ids) {\n          // either this works or we give up\n          if (err) return callback(err)\n          return callback(null, this._idPages(ids, size))\n        }.bind(this))\n      }.bind(this))\n    } else {\n      // this is the last thing we can try\n      this.layerIds(function (err, ids) {\n        if (err) return callback(err)\n        callback(null, this._idPages(ids, size))\n      }.bind(this))\n    }\n  }.bind(this))\n}\n\nfunction singlePage (server, layer) {\n  return [{req: [server, '/', layer, '/query?where=1=1&returnGeometry=true&outFields=*&outSR=4326&f=json'].join('')}]\n}\n\n/**\n * Get the max and min object id\n * @param {object} meta - layer metadata, holds information needed to request oid stats\n * @param {function} callback - returns with an error or objectID stats\n */\nFeatureService.prototype.getObjectIdRange = function (oidField, callback) {\n  this.statistics(oidField, ['min', 'max'], function (err, statResponse) {\n    // TODO this is handled elsewhere now so move it\n    if (err) return callback(err)\n    var eMsg = 'Response from statistics was invalid'\n    var stats\n    try {\n      stats = findMinAndMax(statResponse)\n    } catch (e) {\n      return callback(new Error(eMsg))\n    }\n    if (!stats.min > 0 && !stats.max > 0) return callback(new Error(eMsg))\n    callback(null, stats)\n  })\n}\n\nfunction findMinAndMax (statResponse) {\n  var attributes = statResponse.features[0].attributes\n  var values = Object.keys(attributes).map(function (key) {\n    return attributes[key]\n  })\n  var minMax = {}\n  minMax.min = values[0] < values[1] ? values[0] : values[1]\n  minMax.max = values[1] > values[0] ? values[1] : values[0]\n  return minMax\n}\n\n/**\n * build result Offset based page requests\n * these pages use Server's built in paging via resultOffset and resultRecordCount\n * @param {integer} pages - the number of pages we'll create\n * @param {integer} size - the max number of features per page\n * @returns {object} reqs - contains all the pages for extracting features\n */\nFeatureService.prototype._offsetPages = function (pages, size) {\n  var reqs = []\n  var resultOffset\n  var url = this.server\n\n  for (var i = 0; i < pages; i++) {\n    resultOffset = i * size\n    var pageUrl = url + '/' + this.layer + '/query?outSR=4326&f=json&outFields=*&where=1=1'\n    if (pages === 1) return [{req: pageUrl + '&geometry=&returnGeometry=true&geometryPrecision='}]\n    pageUrl += '&resultOffset=' + resultOffset\n    pageUrl += '&resultRecordCount=' + size\n    pageUrl += '&geometry=&returnGeometry=true&geometryPrecision='\n    reqs.push({req: pageUrl})\n  }\n\n  return reqs\n}\n\n/**\n * build `id` query based page requests\n * these pages use object ids in URLs directly\n * @param {array} ids - an array of each object id in the service\n * @param {integer} size - the max record count for each page\n * @returns {object} reqs - contains all the pages for extracting features\n */\nFeatureService.prototype._idPages = function (ids, size) {\n  var reqs = []\n  var oidField = this.options.objectIdField || 'objectId'\n  var pages = (ids.length / size)\n\n  for (var i = 0; i < pages + 1; i++) {\n    var pageIds = ids.splice(0, size)\n    if (pageIds.length) {\n      var pageMin = pageIds[0]\n      var pageMax = pageIds.pop()\n      var where = [oidField, ' >= ', pageMin, ' AND ', oidField, '<=', pageMax].join('')\n      var pageUrl = this.server + '/' + (this.layer) + '/query?outSR=4326&where=' + where + '&f=json&outFields=*'\n      pageUrl += '&geometry=&returnGeometry=true&geometryPrecision=10'\n      reqs.push({req: pageUrl})\n    }\n  }\n\n  return reqs\n}\n\n/**\n * build object id query based page requests\n * these pages use object ids in where clauses via < and >\n * you could call this objectId queries\n * @param {object} stats - contains the max and min object id\n * @param {integer} size - the size of records to include in each page\n * @returns {object} reqs - contains all the pages for extracting features\n */\nFeatureService.prototype._rangePages = function (stats, size) {\n  var reqs = []\n  var pageUrl\n  var pageMax\n  var pageMin\n  var where\n  var objId = this.options.objectIdField\n\n  var url = this.server\n  var pages = Math.max((stats.max === size) ? stats.max : Math.ceil((stats.max - stats.min) / size), 1)\n\n  for (var i = 0; i < pages; i++) {\n    // there is a bug in server where queries fail if the max value queried is higher than the actual max\n    // so if this is the last page, then set the max to be the maxOID\n    if (i === pages - 1) {\n      pageMax = stats.max\n    } else {\n      pageMax = stats.min + (size * (i + 1)) - 1\n    }\n    pageMin = stats.min + (size * i)\n    where = [objId, '>=', pageMin, '+AND+', objId, '<=', pageMax].join('')\n    pageUrl = url + '/' + (this.layer || 0) + '/query?outSR=4326&where=' + where + '&f=json&outFields=*'\n    pageUrl += '&geometry=&returnGeometry=true&geometryPrecision='\n    reqs.push({req: pageUrl})\n  }\n\n  return reqs\n}\n\n/**\n * Requests a page of features\n * @param {object} task - a task object with a \"req\" property\n * @param {function} callback\n */\nFeatureService.prototype._requestFeatures = function (task, cb) {\n  var self = this\n\n  this.request(task.req, function (err, json) {\n    if (err) return self._catchErrors(task, err, task.req, cb)\n    if (!json || json.error) {\n      if (!json) json = {error: {}}\n      var error = new Error('Request for a page of features failed')\n      error.timestamp = new Date()\n      error.body = json.error\n      error.code = json.error.code || 500\n      return self._catchErrors(task, error, task.req, cb)\n    }\n    self._throttleQueue()\n    cb(null, json)\n  })\n}\n\n/* Catches an errors during paging and handles retry logic\n * @param {object} task - the currently executing job\n * @param {object} e - the error in application logic or from a failed request to a server\n * @param {string} url - the url of the last request for pages\n * @param {function} cb - callback passed through to the abort paging function\n */\nFeatureService.prototype._catchErrors = function (task, error, url, cb) {\n  this._throttleQueue(error)\n  // be defensive in case there was no json payload\n  error.body = error.body || {}\n  // set the error code from the json payload if the error doesn't have one already\n  if (!error.code) error.code = error.body.code\n  error.url = url\n  if (task.retry && task.retry === 3) return this._abortPaging(error, cb)\n  // initiate the count or increment it\n  if (!task.retry) {\n    task.retry = 1\n  } else {\n    task.retry++\n  }\n\n  this.log('info', 'Re-requesting page ' + task.req + ' attempt ' + task.retry)\n\n  setTimeout(function () {\n    this._requestFeatures(task, cb)\n  }.bind(this), task.retry * this.options.backoff)\n}\n\nFeatureService.prototype._throttleQueue = function (fail) {\n  if (fail) this.concurrency -= 0.5\n  else this.concurrency += 0.1\n  if (this.concurrency > this.maxConcurrency) this.concurrency = this.maxConcurrency\n  this.pageQueue.concurrency = this.concurrency >= 1 ? Math.floor(this.concurrency) : 1\n}\n\n/**\n * Aborts the request queue by emptying all queued up tasks\n * @param {object} error - error payload to send back to the original requestor\n * @param {function} callback - calls back with the error payload\n */\nFeatureService.prototype._abortPaging = function (error, callback) {\n  this.pageQueue.kill()\n  error.message = 'Paging aborted: ' + error.message\n  callback(error)\n}\n\nmodule.exports = FeatureService\n","module.exports = {\n  /**\n   * Given a service url and a geometry type, determines a default concurrency for requests\n   *\n   * @param {boolean} hosted - whether or not the service is hosted on ArcGIS Online\n   * @param {string} geomType - the geometry type of the features in the service\n   * @return {integer} the suggested concurrency\n   */\n  setConcurrency: function (hosted, geomType) {\n    var naieve = hosted ? 16 : 4\n    if (!geomType) return naieve\n    var concurrency = geomType.match(/point/i) ? naieve : naieve / 4\n    return Math.floor(concurrency)\n  },\n  /**\n   * Parsed the layer and server from a feature service url\n   * @param {string} url - a link to a feature service\n   * @return {object} contains the layer, the server and whether or not the server is hosted\n   */\n  parseUrl: function (url) {\n    var layer = url.match(/(?:.+\\/(?:feature|map)server\\/)(\\d+)/i)\n    return {\n      layer: layer && layer[1] ? layer[1] : undefined,\n      server: url.match(/.+\\/(feature|map)server/i)[0],\n      hosted: /services(\\d)?(qa|dev)?.arcgis.com/.test(url)\n    }\n  },\n  /**\n   * Strip characters off a layer that don't belong\n   * @param {string} raw - a raw layer options\n   * @return {string} the layer index\n   */\n  sanitizeLayer: function (raw) {\n    if (typeof raw === 'number') return raw\n    else if (typeof raw !== 'string') return undefined\n\n    var match = raw.match(/\\/?(\\d+)/)\n    return match && match[1] ? match[1] : undefined\n  }\n}\n","/*!\n * async\n * https://github.com/caolan/async\n *\n * Copyright 2010-2014 Caolan McMahon\n * Released under the MIT license\n */\n(function () {\n\n    var async = {};\n    function noop() {}\n    function identity(v) {\n        return v;\n    }\n    function toBool(v) {\n        return !!v;\n    }\n    function notId(v) {\n        return !v;\n    }\n\n    // global on the server, window in the browser\n    var previous_async;\n\n    // Establish the root object, `window` (`self`) in the browser, `global`\n    // on the server, or `this` in some virtual machines. We use `self`\n    // instead of `window` for `WebWorker` support.\n    var root = typeof self === 'object' && self.self === self && self ||\n            typeof global === 'object' && global.global === global && global ||\n            this;\n\n    if (root != null) {\n        previous_async = root.async;\n    }\n\n    async.noConflict = function () {\n        root.async = previous_async;\n        return async;\n    };\n\n    function only_once(fn) {\n        return function() {\n            if (fn === null) throw new Error(\"Callback was already called.\");\n            fn.apply(this, arguments);\n            fn = null;\n        };\n    }\n\n    function _once(fn) {\n        return function() {\n            if (fn === null) return;\n            fn.apply(this, arguments);\n            fn = null;\n        };\n    }\n\n    //// cross-browser compatiblity functions ////\n\n    var _toString = Object.prototype.toString;\n\n    var _isArray = Array.isArray || function (obj) {\n        return _toString.call(obj) === '[object Array]';\n    };\n\n    // Ported from underscore.js isObject\n    var _isObject = function(obj) {\n        var type = typeof obj;\n        return type === 'function' || type === 'object' && !!obj;\n    };\n\n    function _isArrayLike(arr) {\n        return _isArray(arr) || (\n            // has a positive integer length property\n            typeof arr.length === \"number\" &&\n            arr.length >= 0 &&\n            arr.length % 1 === 0\n        );\n    }\n\n    function _arrayEach(arr, iterator) {\n        var index = -1,\n            length = arr.length;\n\n        while (++index < length) {\n            iterator(arr[index], index, arr);\n        }\n    }\n\n    function _map(arr, iterator) {\n        var index = -1,\n            length = arr.length,\n            result = Array(length);\n\n        while (++index < length) {\n            result[index] = iterator(arr[index], index, arr);\n        }\n        return result;\n    }\n\n    function _range(count) {\n        return _map(Array(count), function (v, i) { return i; });\n    }\n\n    function _reduce(arr, iterator, memo) {\n        _arrayEach(arr, function (x, i, a) {\n            memo = iterator(memo, x, i, a);\n        });\n        return memo;\n    }\n\n    function _forEachOf(object, iterator) {\n        _arrayEach(_keys(object), function (key) {\n            iterator(object[key], key);\n        });\n    }\n\n    function _indexOf(arr, item) {\n        for (var i = 0; i < arr.length; i++) {\n            if (arr[i] === item) return i;\n        }\n        return -1;\n    }\n\n    var _keys = Object.keys || function (obj) {\n        var keys = [];\n        for (var k in obj) {\n            if (obj.hasOwnProperty(k)) {\n                keys.push(k);\n            }\n        }\n        return keys;\n    };\n\n    function _keyIterator(coll) {\n        var i = -1;\n        var len;\n        var keys;\n        if (_isArrayLike(coll)) {\n            len = coll.length;\n            return function next() {\n                i++;\n                return i < len ? i : null;\n            };\n        } else {\n            keys = _keys(coll);\n            len = keys.length;\n            return function next() {\n                i++;\n                return i < len ? keys[i] : null;\n            };\n        }\n    }\n\n    // Similar to ES6's rest param (http://ariya.ofilabs.com/2013/03/es6-and-rest-parameter.html)\n    // This accumulates the arguments passed into an array, after a given index.\n    // From underscore.js (https://github.com/jashkenas/underscore/pull/2140).\n    function _restParam(func, startIndex) {\n        startIndex = startIndex == null ? func.length - 1 : +startIndex;\n        return function() {\n            var length = Math.max(arguments.length - startIndex, 0);\n            var rest = Array(length);\n            for (var index = 0; index < length; index++) {\n                rest[index] = arguments[index + startIndex];\n            }\n            switch (startIndex) {\n                case 0: return func.call(this, rest);\n                case 1: return func.call(this, arguments[0], rest);\n            }\n            // Currently unused but handle cases outside of the switch statement:\n            // var args = Array(startIndex + 1);\n            // for (index = 0; index < startIndex; index++) {\n            //     args[index] = arguments[index];\n            // }\n            // args[startIndex] = rest;\n            // return func.apply(this, args);\n        };\n    }\n\n    function _withoutIndex(iterator) {\n        return function (value, index, callback) {\n            return iterator(value, callback);\n        };\n    }\n\n    //// exported async module functions ////\n\n    //// nextTick implementation with browser-compatible fallback ////\n\n    // capture the global reference to guard against fakeTimer mocks\n    var _setImmediate = typeof setImmediate === 'function' && setImmediate;\n\n    var _delay = _setImmediate ? function(fn) {\n        // not a direct alias for IE10 compatibility\n        _setImmediate(fn);\n    } : function(fn) {\n        setTimeout(fn, 0);\n    };\n\n    if (typeof process === 'object' && typeof process.nextTick === 'function') {\n        async.nextTick = process.nextTick;\n    } else {\n        async.nextTick = _delay;\n    }\n    async.setImmediate = _setImmediate ? _delay : async.nextTick;\n\n\n    async.forEach =\n    async.each = function (arr, iterator, callback) {\n        return async.eachOf(arr, _withoutIndex(iterator), callback);\n    };\n\n    async.forEachSeries =\n    async.eachSeries = function (arr, iterator, callback) {\n        return async.eachOfSeries(arr, _withoutIndex(iterator), callback);\n    };\n\n\n    async.forEachLimit =\n    async.eachLimit = function (arr, limit, iterator, callback) {\n        return _eachOfLimit(limit)(arr, _withoutIndex(iterator), callback);\n    };\n\n    async.forEachOf =\n    async.eachOf = function (object, iterator, callback) {\n        callback = _once(callback || noop);\n        object = object || [];\n\n        var iter = _keyIterator(object);\n        var key, completed = 0;\n\n        while ((key = iter()) != null) {\n            completed += 1;\n            iterator(object[key], key, only_once(done));\n        }\n\n        if (completed === 0) callback(null);\n\n        function done(err) {\n            completed--;\n            if (err) {\n                callback(err);\n            }\n            // Check key is null in case iterator isn't exhausted\n            // and done resolved synchronously.\n            else if (key === null && completed <= 0) {\n                callback(null);\n            }\n        }\n    };\n\n    async.forEachOfSeries =\n    async.eachOfSeries = function (obj, iterator, callback) {\n        callback = _once(callback || noop);\n        obj = obj || [];\n        var nextKey = _keyIterator(obj);\n        var key = nextKey();\n        function iterate() {\n            var sync = true;\n            if (key === null) {\n                return callback(null);\n            }\n            iterator(obj[key], key, only_once(function (err) {\n                if (err) {\n                    callback(err);\n                }\n                else {\n                    key = nextKey();\n                    if (key === null) {\n                        return callback(null);\n                    } else {\n                        if (sync) {\n                            async.setImmediate(iterate);\n                        } else {\n                            iterate();\n                        }\n                    }\n                }\n            }));\n            sync = false;\n        }\n        iterate();\n    };\n\n\n\n    async.forEachOfLimit =\n    async.eachOfLimit = function (obj, limit, iterator, callback) {\n        _eachOfLimit(limit)(obj, iterator, callback);\n    };\n\n    function _eachOfLimit(limit) {\n\n        return function (obj, iterator, callback) {\n            callback = _once(callback || noop);\n            obj = obj || [];\n            var nextKey = _keyIterator(obj);\n            if (limit <= 0) {\n                return callback(null);\n            }\n            var done = false;\n            var running = 0;\n            var errored = false;\n\n            (function replenish () {\n                if (done && running <= 0) {\n                    return callback(null);\n                }\n\n                while (running < limit && !errored) {\n                    var key = nextKey();\n                    if (key === null) {\n                        done = true;\n                        if (running <= 0) {\n                            callback(null);\n                        }\n                        return;\n                    }\n                    running += 1;\n                    iterator(obj[key], key, only_once(function (err) {\n                        running -= 1;\n                        if (err) {\n                            callback(err);\n                            errored = true;\n                        }\n                        else {\n                            replenish();\n                        }\n                    }));\n                }\n            })();\n        };\n    }\n\n\n    function doParallel(fn) {\n        return function (obj, iterator, callback) {\n            return fn(async.eachOf, obj, iterator, callback);\n        };\n    }\n    function doParallelLimit(fn) {\n        return function (obj, limit, iterator, callback) {\n            return fn(_eachOfLimit(limit), obj, iterator, callback);\n        };\n    }\n    function doSeries(fn) {\n        return function (obj, iterator, callback) {\n            return fn(async.eachOfSeries, obj, iterator, callback);\n        };\n    }\n\n    function _asyncMap(eachfn, arr, iterator, callback) {\n        callback = _once(callback || noop);\n        arr = arr || [];\n        var results = _isArrayLike(arr) ? [] : {};\n        eachfn(arr, function (value, index, callback) {\n            iterator(value, function (err, v) {\n                results[index] = v;\n                callback(err);\n            });\n        }, function (err) {\n            callback(err, results);\n        });\n    }\n\n    async.map = doParallel(_asyncMap);\n    async.mapSeries = doSeries(_asyncMap);\n    async.mapLimit = doParallelLimit(_asyncMap);\n\n    // reduce only has a series version, as doing reduce in parallel won't\n    // work in many situations.\n    async.inject =\n    async.foldl =\n    async.reduce = function (arr, memo, iterator, callback) {\n        async.eachOfSeries(arr, function (x, i, callback) {\n            iterator(memo, x, function (err, v) {\n                memo = v;\n                callback(err);\n            });\n        }, function (err) {\n            callback(err, memo);\n        });\n    };\n\n    async.foldr =\n    async.reduceRight = function (arr, memo, iterator, callback) {\n        var reversed = _map(arr, identity).reverse();\n        async.reduce(reversed, memo, iterator, callback);\n    };\n\n    async.transform = function (arr, memo, iterator, callback) {\n        if (arguments.length === 3) {\n            callback = iterator;\n            iterator = memo;\n            memo = _isArray(arr) ? [] : {};\n        }\n\n        async.eachOf(arr, function(v, k, cb) {\n            iterator(memo, v, k, cb);\n        }, function(err) {\n            callback(err, memo);\n        });\n    };\n\n    function _filter(eachfn, arr, iterator, callback) {\n        var results = [];\n        eachfn(arr, function (x, index, callback) {\n            iterator(x, function (v) {\n                if (v) {\n                    results.push({index: index, value: x});\n                }\n                callback();\n            });\n        }, function () {\n            callback(_map(results.sort(function (a, b) {\n                return a.index - b.index;\n            }), function (x) {\n                return x.value;\n            }));\n        });\n    }\n\n    async.select =\n    async.filter = doParallel(_filter);\n\n    async.selectLimit =\n    async.filterLimit = doParallelLimit(_filter);\n\n    async.selectSeries =\n    async.filterSeries = doSeries(_filter);\n\n    function _reject(eachfn, arr, iterator, callback) {\n        _filter(eachfn, arr, function(value, cb) {\n            iterator(value, function(v) {\n                cb(!v);\n            });\n        }, callback);\n    }\n    async.reject = doParallel(_reject);\n    async.rejectLimit = doParallelLimit(_reject);\n    async.rejectSeries = doSeries(_reject);\n\n    function _createTester(eachfn, check, getResult) {\n        return function(arr, limit, iterator, cb) {\n            function done() {\n                if (cb) cb(getResult(false, void 0));\n            }\n            function iteratee(x, _, callback) {\n                if (!cb) return callback();\n                iterator(x, function (v) {\n                    if (cb && check(v)) {\n                        cb(getResult(true, x));\n                        cb = iterator = false;\n                    }\n                    callback();\n                });\n            }\n            if (arguments.length > 3) {\n                eachfn(arr, limit, iteratee, done);\n            } else {\n                cb = iterator;\n                iterator = limit;\n                eachfn(arr, iteratee, done);\n            }\n        };\n    }\n\n    async.any =\n    async.some = _createTester(async.eachOf, toBool, identity);\n\n    async.someLimit = _createTester(async.eachOfLimit, toBool, identity);\n\n    async.all =\n    async.every = _createTester(async.eachOf, notId, notId);\n\n    async.everyLimit = _createTester(async.eachOfLimit, notId, notId);\n\n    function _findGetResult(v, x) {\n        return x;\n    }\n    async.detect = _createTester(async.eachOf, identity, _findGetResult);\n    async.detectSeries = _createTester(async.eachOfSeries, identity, _findGetResult);\n    async.detectLimit = _createTester(async.eachOfLimit, identity, _findGetResult);\n\n    async.sortBy = function (arr, iterator, callback) {\n        async.map(arr, function (x, callback) {\n            iterator(x, function (err, criteria) {\n                if (err) {\n                    callback(err);\n                }\n                else {\n                    callback(null, {value: x, criteria: criteria});\n                }\n            });\n        }, function (err, results) {\n            if (err) {\n                return callback(err);\n            }\n            else {\n                callback(null, _map(results.sort(comparator), function (x) {\n                    return x.value;\n                }));\n            }\n\n        });\n\n        function comparator(left, right) {\n            var a = left.criteria, b = right.criteria;\n            return a < b ? -1 : a > b ? 1 : 0;\n        }\n    };\n\n    async.auto = function (tasks, concurrency, callback) {\n        if (typeof arguments[1] === 'function') {\n            // concurrency is optional, shift the args.\n            callback = concurrency;\n            concurrency = null;\n        }\n        callback = _once(callback || noop);\n        var keys = _keys(tasks);\n        var remainingTasks = keys.length;\n        if (!remainingTasks) {\n            return callback(null);\n        }\n        if (!concurrency) {\n            concurrency = remainingTasks;\n        }\n\n        var results = {};\n        var runningTasks = 0;\n\n        var hasError = false;\n\n        var listeners = [];\n        function addListener(fn) {\n            listeners.unshift(fn);\n        }\n        function removeListener(fn) {\n            var idx = _indexOf(listeners, fn);\n            if (idx >= 0) listeners.splice(idx, 1);\n        }\n        function taskComplete() {\n            remainingTasks--;\n            _arrayEach(listeners.slice(0), function (fn) {\n                fn();\n            });\n        }\n\n        addListener(function () {\n            if (!remainingTasks) {\n                callback(null, results);\n            }\n        });\n\n        _arrayEach(keys, function (k) {\n            if (hasError) return;\n            var task = _isArray(tasks[k]) ? tasks[k]: [tasks[k]];\n            var taskCallback = _restParam(function(err, args) {\n                runningTasks--;\n                if (args.length <= 1) {\n                    args = args[0];\n                }\n                if (err) {\n                    var safeResults = {};\n                    _forEachOf(results, function(val, rkey) {\n                        safeResults[rkey] = val;\n                    });\n                    safeResults[k] = args;\n                    hasError = true;\n\n                    callback(err, safeResults);\n                }\n                else {\n                    results[k] = args;\n                    async.setImmediate(taskComplete);\n                }\n            });\n            var requires = task.slice(0, task.length - 1);\n            // prevent dead-locks\n            var len = requires.length;\n            var dep;\n            while (len--) {\n                if (!(dep = tasks[requires[len]])) {\n                    throw new Error('Has nonexistent dependency in ' + requires.join(', '));\n                }\n                if (_isArray(dep) && _indexOf(dep, k) >= 0) {\n                    throw new Error('Has cyclic dependencies');\n                }\n            }\n            function ready() {\n                return runningTasks < concurrency && _reduce(requires, function (a, x) {\n                    return (a && results.hasOwnProperty(x));\n                }, true) && !results.hasOwnProperty(k);\n            }\n            if (ready()) {\n                runningTasks++;\n                task[task.length - 1](taskCallback, results);\n            }\n            else {\n                addListener(listener);\n            }\n            function listener() {\n                if (ready()) {\n                    runningTasks++;\n                    removeListener(listener);\n                    task[task.length - 1](taskCallback, results);\n                }\n            }\n        });\n    };\n\n\n\n    async.retry = function(times, task, callback) {\n        var DEFAULT_TIMES = 5;\n        var DEFAULT_INTERVAL = 0;\n\n        var attempts = [];\n\n        var opts = {\n            times: DEFAULT_TIMES,\n            interval: DEFAULT_INTERVAL\n        };\n\n        function parseTimes(acc, t){\n            if(typeof t === 'number'){\n                acc.times = parseInt(t, 10) || DEFAULT_TIMES;\n            } else if(typeof t === 'object'){\n                acc.times = parseInt(t.times, 10) || DEFAULT_TIMES;\n                acc.interval = parseInt(t.interval, 10) || DEFAULT_INTERVAL;\n            } else {\n                throw new Error('Unsupported argument type for \\'times\\': ' + typeof t);\n            }\n        }\n\n        var length = arguments.length;\n        if (length < 1 || length > 3) {\n            throw new Error('Invalid arguments - must be either (task), (task, callback), (times, task) or (times, task, callback)');\n        } else if (length <= 2 && typeof times === 'function') {\n            callback = task;\n            task = times;\n        }\n        if (typeof times !== 'function') {\n            parseTimes(opts, times);\n        }\n        opts.callback = callback;\n        opts.task = task;\n\n        function wrappedTask(wrappedCallback, wrappedResults) {\n            function retryAttempt(task, finalAttempt) {\n                return function(seriesCallback) {\n                    task(function(err, result){\n                        seriesCallback(!err || finalAttempt, {err: err, result: result});\n                    }, wrappedResults);\n                };\n            }\n\n            function retryInterval(interval){\n                return function(seriesCallback){\n                    setTimeout(function(){\n                        seriesCallback(null);\n                    }, interval);\n                };\n            }\n\n            while (opts.times) {\n\n                var finalAttempt = !(opts.times-=1);\n                attempts.push(retryAttempt(opts.task, finalAttempt));\n                if(!finalAttempt && opts.interval > 0){\n                    attempts.push(retryInterval(opts.interval));\n                }\n            }\n\n            async.series(attempts, function(done, data){\n                data = data[data.length - 1];\n                (wrappedCallback || opts.callback)(data.err, data.result);\n            });\n        }\n\n        // If a callback is passed, run this as a controll flow\n        return opts.callback ? wrappedTask() : wrappedTask;\n    };\n\n    async.waterfall = function (tasks, callback) {\n        callback = _once(callback || noop);\n        if (!_isArray(tasks)) {\n            var err = new Error('First argument to waterfall must be an array of functions');\n            return callback(err);\n        }\n        if (!tasks.length) {\n            return callback();\n        }\n        function wrapIterator(iterator) {\n            return _restParam(function (err, args) {\n                if (err) {\n                    callback.apply(null, [err].concat(args));\n                }\n                else {\n                    var next = iterator.next();\n                    if (next) {\n                        args.push(wrapIterator(next));\n                    }\n                    else {\n                        args.push(callback);\n                    }\n                    ensureAsync(iterator).apply(null, args);\n                }\n            });\n        }\n        wrapIterator(async.iterator(tasks))();\n    };\n\n    function _parallel(eachfn, tasks, callback) {\n        callback = callback || noop;\n        var results = _isArrayLike(tasks) ? [] : {};\n\n        eachfn(tasks, function (task, key, callback) {\n            task(_restParam(function (err, args) {\n                if (args.length <= 1) {\n                    args = args[0];\n                }\n                results[key] = args;\n                callback(err);\n            }));\n        }, function (err) {\n            callback(err, results);\n        });\n    }\n\n    async.parallel = function (tasks, callback) {\n        _parallel(async.eachOf, tasks, callback);\n    };\n\n    async.parallelLimit = function(tasks, limit, callback) {\n        _parallel(_eachOfLimit(limit), tasks, callback);\n    };\n\n    async.series = function(tasks, callback) {\n        _parallel(async.eachOfSeries, tasks, callback);\n    };\n\n    async.iterator = function (tasks) {\n        function makeCallback(index) {\n            function fn() {\n                if (tasks.length) {\n                    tasks[index].apply(null, arguments);\n                }\n                return fn.next();\n            }\n            fn.next = function () {\n                return (index < tasks.length - 1) ? makeCallback(index + 1): null;\n            };\n            return fn;\n        }\n        return makeCallback(0);\n    };\n\n    async.apply = _restParam(function (fn, args) {\n        return _restParam(function (callArgs) {\n            return fn.apply(\n                null, args.concat(callArgs)\n            );\n        });\n    });\n\n    function _concat(eachfn, arr, fn, callback) {\n        var result = [];\n        eachfn(arr, function (x, index, cb) {\n            fn(x, function (err, y) {\n                result = result.concat(y || []);\n                cb(err);\n            });\n        }, function (err) {\n            callback(err, result);\n        });\n    }\n    async.concat = doParallel(_concat);\n    async.concatSeries = doSeries(_concat);\n\n    async.whilst = function (test, iterator, callback) {\n        callback = callback || noop;\n        if (test()) {\n            var next = _restParam(function(err, args) {\n                if (err) {\n                    callback(err);\n                } else if (test.apply(this, args)) {\n                    iterator(next);\n                } else {\n                    callback.apply(null, [null].concat(args));\n                }\n            });\n            iterator(next);\n        } else {\n            callback(null);\n        }\n    };\n\n    async.doWhilst = function (iterator, test, callback) {\n        var calls = 0;\n        return async.whilst(function() {\n            return ++calls <= 1 || test.apply(this, arguments);\n        }, iterator, callback);\n    };\n\n    async.until = function (test, iterator, callback) {\n        return async.whilst(function() {\n            return !test.apply(this, arguments);\n        }, iterator, callback);\n    };\n\n    async.doUntil = function (iterator, test, callback) {\n        return async.doWhilst(iterator, function() {\n            return !test.apply(this, arguments);\n        }, callback);\n    };\n\n    async.during = function (test, iterator, callback) {\n        callback = callback || noop;\n\n        var next = _restParam(function(err, args) {\n            if (err) {\n                callback(err);\n            } else {\n                args.push(check);\n                test.apply(this, args);\n            }\n        });\n\n        var check = function(err, truth) {\n            if (err) {\n                callback(err);\n            } else if (truth) {\n                iterator(next);\n            } else {\n                callback(null);\n            }\n        };\n\n        test(check);\n    };\n\n    async.doDuring = function (iterator, test, callback) {\n        var calls = 0;\n        async.during(function(next) {\n            if (calls++ < 1) {\n                next(null, true);\n            } else {\n                test.apply(this, arguments);\n            }\n        }, iterator, callback);\n    };\n\n    function _queue(worker, concurrency, payload) {\n        if (concurrency == null) {\n            concurrency = 1;\n        }\n        else if(concurrency === 0) {\n            throw new Error('Concurrency must not be zero');\n        }\n        function _insert(q, data, pos, callback) {\n            if (callback != null && typeof callback !== \"function\") {\n                throw new Error(\"task callback must be a function\");\n            }\n            q.started = true;\n            if (!_isArray(data)) {\n                data = [data];\n            }\n            if(data.length === 0 && q.idle()) {\n                // call drain immediately if there are no tasks\n                return async.setImmediate(function() {\n                    q.drain();\n                });\n            }\n            _arrayEach(data, function(task) {\n                var item = {\n                    data: task,\n                    callback: callback || noop\n                };\n\n                if (pos) {\n                    q.tasks.unshift(item);\n                } else {\n                    q.tasks.push(item);\n                }\n\n                if (q.tasks.length === q.concurrency) {\n                    q.saturated();\n                }\n            });\n            async.setImmediate(q.process);\n        }\n        function _next(q, tasks) {\n            return function(){\n                workers -= 1;\n\n                var removed = false;\n                var args = arguments;\n                _arrayEach(tasks, function (task) {\n                    _arrayEach(workersList, function (worker, index) {\n                        if (worker === task && !removed) {\n                            workersList.splice(index, 1);\n                            removed = true;\n                        }\n                    });\n\n                    task.callback.apply(task, args);\n                });\n                if (q.tasks.length + workers === 0) {\n                    q.drain();\n                }\n                q.process();\n            };\n        }\n\n        var workers = 0;\n        var workersList = [];\n        var q = {\n            tasks: [],\n            concurrency: concurrency,\n            payload: payload,\n            saturated: noop,\n            empty: noop,\n            drain: noop,\n            started: false,\n            paused: false,\n            push: function (data, callback) {\n                _insert(q, data, false, callback);\n            },\n            kill: function () {\n                q.drain = noop;\n                q.tasks = [];\n            },\n            unshift: function (data, callback) {\n                _insert(q, data, true, callback);\n            },\n            process: function () {\n                while(!q.paused && workers < q.concurrency && q.tasks.length){\n\n                    var tasks = q.payload ?\n                        q.tasks.splice(0, q.payload) :\n                        q.tasks.splice(0, q.tasks.length);\n\n                    var data = _map(tasks, function (task) {\n                        return task.data;\n                    });\n\n                    if (q.tasks.length === 0) {\n                        q.empty();\n                    }\n                    workers += 1;\n                    workersList.push(tasks[0]);\n                    var cb = only_once(_next(q, tasks));\n                    worker(data, cb);\n                }\n            },\n            length: function () {\n                return q.tasks.length;\n            },\n            running: function () {\n                return workers;\n            },\n            workersList: function () {\n                return workersList;\n            },\n            idle: function() {\n                return q.tasks.length + workers === 0;\n            },\n            pause: function () {\n                q.paused = true;\n            },\n            resume: function () {\n                if (q.paused === false) { return; }\n                q.paused = false;\n                var resumeCount = Math.min(q.concurrency, q.tasks.length);\n                // Need to call q.process once per concurrent\n                // worker to preserve full concurrency after pause\n                for (var w = 1; w <= resumeCount; w++) {\n                    async.setImmediate(q.process);\n                }\n            }\n        };\n        return q;\n    }\n\n    async.queue = function (worker, concurrency) {\n        var q = _queue(function (items, cb) {\n            worker(items[0], cb);\n        }, concurrency, 1);\n\n        return q;\n    };\n\n    async.priorityQueue = function (worker, concurrency) {\n\n        function _compareTasks(a, b){\n            return a.priority - b.priority;\n        }\n\n        function _binarySearch(sequence, item, compare) {\n            var beg = -1,\n                end = sequence.length - 1;\n            while (beg < end) {\n                var mid = beg + ((end - beg + 1) >>> 1);\n                if (compare(item, sequence[mid]) >= 0) {\n                    beg = mid;\n                } else {\n                    end = mid - 1;\n                }\n            }\n            return beg;\n        }\n\n        function _insert(q, data, priority, callback) {\n            if (callback != null && typeof callback !== \"function\") {\n                throw new Error(\"task callback must be a function\");\n            }\n            q.started = true;\n            if (!_isArray(data)) {\n                data = [data];\n            }\n            if(data.length === 0) {\n                // call drain immediately if there are no tasks\n                return async.setImmediate(function() {\n                    q.drain();\n                });\n            }\n            _arrayEach(data, function(task) {\n                var item = {\n                    data: task,\n                    priority: priority,\n                    callback: typeof callback === 'function' ? callback : noop\n                };\n\n                q.tasks.splice(_binarySearch(q.tasks, item, _compareTasks) + 1, 0, item);\n\n                if (q.tasks.length === q.concurrency) {\n                    q.saturated();\n                }\n                async.setImmediate(q.process);\n            });\n        }\n\n        // Start with a normal queue\n        var q = async.queue(worker, concurrency);\n\n        // Override push to accept second parameter representing priority\n        q.push = function (data, priority, callback) {\n            _insert(q, data, priority, callback);\n        };\n\n        // Remove unshift function\n        delete q.unshift;\n\n        return q;\n    };\n\n    async.cargo = function (worker, payload) {\n        return _queue(worker, 1, payload);\n    };\n\n    function _console_fn(name) {\n        return _restParam(function (fn, args) {\n            fn.apply(null, args.concat([_restParam(function (err, args) {\n                if (typeof console === 'object') {\n                    if (err) {\n                        if (console.error) {\n                            console.error(err);\n                        }\n                    }\n                    else if (console[name]) {\n                        _arrayEach(args, function (x) {\n                            console[name](x);\n                        });\n                    }\n                }\n            })]));\n        });\n    }\n    async.log = _console_fn('log');\n    async.dir = _console_fn('dir');\n    /*async.info = _console_fn('info');\n    async.warn = _console_fn('warn');\n    async.error = _console_fn('error');*/\n\n    async.memoize = function (fn, hasher) {\n        var memo = {};\n        var queues = {};\n        var has = Object.prototype.hasOwnProperty;\n        hasher = hasher || identity;\n        var memoized = _restParam(function memoized(args) {\n            var callback = args.pop();\n            var key = hasher.apply(null, args);\n            if (has.call(memo, key)) {   \n                async.setImmediate(function () {\n                    callback.apply(null, memo[key]);\n                });\n            }\n            else if (has.call(queues, key)) {\n                queues[key].push(callback);\n            }\n            else {\n                queues[key] = [callback];\n                fn.apply(null, args.concat([_restParam(function (args) {\n                    memo[key] = args;\n                    var q = queues[key];\n                    delete queues[key];\n                    for (var i = 0, l = q.length; i < l; i++) {\n                        q[i].apply(null, args);\n                    }\n                })]));\n            }\n        });\n        memoized.memo = memo;\n        memoized.unmemoized = fn;\n        return memoized;\n    };\n\n    async.unmemoize = function (fn) {\n        return function () {\n            return (fn.unmemoized || fn).apply(null, arguments);\n        };\n    };\n\n    function _times(mapper) {\n        return function (count, iterator, callback) {\n            mapper(_range(count), iterator, callback);\n        };\n    }\n\n    async.times = _times(async.map);\n    async.timesSeries = _times(async.mapSeries);\n    async.timesLimit = function (count, limit, iterator, callback) {\n        return async.mapLimit(_range(count), limit, iterator, callback);\n    };\n\n    async.seq = function (/* functions... */) {\n        var fns = arguments;\n        return _restParam(function (args) {\n            var that = this;\n\n            var callback = args[args.length - 1];\n            if (typeof callback == 'function') {\n                args.pop();\n            } else {\n                callback = noop;\n            }\n\n            async.reduce(fns, args, function (newargs, fn, cb) {\n                fn.apply(that, newargs.concat([_restParam(function (err, nextargs) {\n                    cb(err, nextargs);\n                })]));\n            },\n            function (err, results) {\n                callback.apply(that, [err].concat(results));\n            });\n        });\n    };\n\n    async.compose = function (/* functions... */) {\n        return async.seq.apply(null, Array.prototype.reverse.call(arguments));\n    };\n\n\n    function _applyEach(eachfn) {\n        return _restParam(function(fns, args) {\n            var go = _restParam(function(args) {\n                var that = this;\n                var callback = args.pop();\n                return eachfn(fns, function (fn, _, cb) {\n                    fn.apply(that, args.concat([cb]));\n                },\n                callback);\n            });\n            if (args.length) {\n                return go.apply(this, args);\n            }\n            else {\n                return go;\n            }\n        });\n    }\n\n    async.applyEach = _applyEach(async.eachOf);\n    async.applyEachSeries = _applyEach(async.eachOfSeries);\n\n\n    async.forever = function (fn, callback) {\n        var done = only_once(callback || noop);\n        var task = ensureAsync(fn);\n        function next(err) {\n            if (err) {\n                return done(err);\n            }\n            task(next);\n        }\n        next();\n    };\n\n    function ensureAsync(fn) {\n        return _restParam(function (args) {\n            var callback = args.pop();\n            args.push(function () {\n                var innerArgs = arguments;\n                if (sync) {\n                    async.setImmediate(function () {\n                        callback.apply(null, innerArgs);\n                    });\n                } else {\n                    callback.apply(null, innerArgs);\n                }\n            });\n            var sync = true;\n            fn.apply(this, args);\n            sync = false;\n        });\n    }\n\n    async.ensureAsync = ensureAsync;\n\n    async.constant = _restParam(function(values) {\n        var args = [null].concat(values);\n        return function (callback) {\n            return callback.apply(this, args);\n        };\n    });\n\n    async.wrapSync =\n    async.asyncify = function asyncify(func) {\n        return _restParam(function (args) {\n            var callback = args.pop();\n            var result;\n            try {\n                result = func.apply(this, args);\n            } catch (e) {\n                return callback(e);\n            }\n            // if result is Promise object\n            if (_isObject(result) && typeof result.then === \"function\") {\n                result.then(function(value) {\n                    callback(null, value);\n                })[\"catch\"](function(err) {\n                    callback(err.message ? err : new Error(err));\n                });\n            } else {\n                callback(null, result);\n            }\n        });\n    };\n\n    // Node.js\n    if (typeof module === 'object' && module.exports) {\n        module.exports = async;\n    }\n    // AMD / RequireJS\n    else if (typeof define === 'function' && define.amd) {\n        define([], function () {\n            return async;\n        });\n    }\n    // included directly via <script> tag\n    else {\n        root.async = async;\n    }\n\n}());\n","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","var isFunction = require('is-function')\n\nmodule.exports = forEach\n\nvar toString = Object.prototype.toString\nvar hasOwnProperty = Object.prototype.hasOwnProperty\n\nfunction forEach(list, iterator, context) {\n    if (!isFunction(iterator)) {\n        throw new TypeError('iterator must be a function')\n    }\n\n    if (arguments.length < 3) {\n        context = this\n    }\n    \n    if (toString.call(list) === '[object Array]')\n        forEachArray(list, iterator, context)\n    else if (typeof list === 'string')\n        forEachString(list, iterator, context)\n    else\n        forEachObject(list, iterator, context)\n}\n\nfunction forEachArray(array, iterator, context) {\n    for (var i = 0, len = array.length; i < len; i++) {\n        if (hasOwnProperty.call(array, i)) {\n            iterator.call(context, array[i], i, array)\n        }\n    }\n}\n\nfunction forEachString(string, iterator, context) {\n    for (var i = 0, len = string.length; i < len; i++) {\n        // no such thing as a sparse string.\n        iterator.call(context, string.charAt(i), i, string)\n    }\n}\n\nfunction forEachObject(object, iterator, context) {\n    for (var k in object) {\n        if (hasOwnProperty.call(object, k)) {\n            iterator.call(context, object[k], k, object)\n        }\n    }\n}\n","if (typeof window !== \"undefined\") {\n    module.exports = window;\n} else if (typeof global !== \"undefined\") {\n    module.exports = global;\n} else if (typeof self !== \"undefined\"){\n    module.exports = self;\n} else {\n    module.exports = {};\n}\n","module.exports = isFunction\n\nvar toString = Object.prototype.toString\n\nfunction isFunction (fn) {\n  var string = toString.call(fn)\n  return string === '[object Function]' ||\n    (typeof fn === 'function' && string !== '[object RegExp]') ||\n    (typeof window !== 'undefined' &&\n     // IE8 and below\n     (fn === window.setTimeout ||\n      fn === window.alert ||\n      fn === window.confirm ||\n      fn === window.prompt))\n};\n","'use strict';\nvar propIsEnumerable = Object.prototype.propertyIsEnumerable;\n\nfunction ToObject(val) {\n\tif (val == null) {\n\t\tthrow new TypeError('Object.assign cannot be called with null or undefined');\n\t}\n\n\treturn Object(val);\n}\n\nfunction ownEnumerableKeys(obj) {\n\tvar keys = Object.getOwnPropertyNames(obj);\n\n\tif (Object.getOwnPropertySymbols) {\n\t\tkeys = keys.concat(Object.getOwnPropertySymbols(obj));\n\t}\n\n\treturn keys.filter(function (key) {\n\t\treturn propIsEnumerable.call(obj, key);\n\t});\n}\n\nmodule.exports = Object.assign || function (target, source) {\n\tvar from;\n\tvar keys;\n\tvar to = ToObject(target);\n\n\tfor (var s = 1; s < arguments.length; s++) {\n\t\tfrom = arguments[s];\n\t\tkeys = ownEnumerableKeys(Object(from));\n\n\t\tfor (var i = 0; i < keys.length; i++) {\n\t\t\tto[keys[i]] = from[keys[i]];\n\t\t}\n\t}\n\n\treturn to;\n};\n","var trim = require('trim')\n  , forEach = require('for-each')\n  , isArray = function(arg) {\n      return Object.prototype.toString.call(arg) === '[object Array]';\n    }\n\nmodule.exports = function (headers) {\n  if (!headers)\n    return {}\n\n  var result = {}\n\n  forEach(\n      trim(headers).split('\\n')\n    , function (row) {\n        var index = row.indexOf(':')\n          , key = trim(row.slice(0, index)).toLowerCase()\n          , value = trim(row.slice(index + 1))\n\n        if (typeof(result[key]) === 'undefined') {\n          result[key] = value\n        } else if (isArray(result[key])) {\n          result[key].push(value)\n        } else {\n          result[key] = [ result[key], value ]\n        }\n      }\n  )\n\n  return result\n}","'use strict';\nvar strictUriEncode = require('strict-uri-encode');\n\nexports.extract = function (str) {\n\treturn str.split('?')[1] || '';\n};\n\nexports.parse = function (str) {\n\tif (typeof str !== 'string') {\n\t\treturn {};\n\t}\n\n\tstr = str.trim().replace(/^(\\?|#|&)/, '');\n\n\tif (!str) {\n\t\treturn {};\n\t}\n\n\treturn str.split('&').reduce(function (ret, param) {\n\t\tvar parts = param.replace(/\\+/g, ' ').split('=');\n\t\t// Firefox (pre 40) decodes `%3D` to `=`\n\t\t// https://github.com/sindresorhus/query-string/pull/37\n\t\tvar key = parts.shift();\n\t\tvar val = parts.length > 0 ? parts.join('=') : undefined;\n\n\t\tkey = decodeURIComponent(key);\n\n\t\t// missing `=` should be `null`:\n\t\t// http://w3.org/TR/2012/WD-url-20120524/#collect-url-parameters\n\t\tval = val === undefined ? null : decodeURIComponent(val);\n\n\t\tif (!ret.hasOwnProperty(key)) {\n\t\t\tret[key] = val;\n\t\t} else if (Array.isArray(ret[key])) {\n\t\t\tret[key].push(val);\n\t\t} else {\n\t\t\tret[key] = [ret[key], val];\n\t\t}\n\n\t\treturn ret;\n\t}, {});\n};\n\nexports.stringify = function (obj) {\n\treturn obj ? Object.keys(obj).sort().map(function (key) {\n\t\tvar val = obj[key];\n\n\t\tif (Array.isArray(val)) {\n\t\t\treturn val.sort().map(function (val2) {\n\t\t\t\treturn strictUriEncode(key) + '=' + strictUriEncode(val2);\n\t\t\t}).join('&');\n\t\t}\n\n\t\treturn strictUriEncode(key) + '=' + strictUriEncode(val);\n\t}).filter(function (x) {\n\t\treturn x.length > 0;\n\t}).join('&') : '';\n};\n","'use strict';\nmodule.exports = function (str) {\n\treturn encodeURIComponent(str).replace(/[!'()*]/g, function (c) {\n\t\treturn '%' + c.charCodeAt(0).toString(16).toUpperCase();\n\t});\n};\n","\nexports = module.exports = trim;\n\nfunction trim(str){\n  return str.replace(/^\\s*|\\s*$/g, '');\n}\n\nexports.left = function(str){\n  return str.replace(/^\\s*/, '');\n};\n\nexports.right = function(str){\n  return str.replace(/\\s*$/, '');\n};\n","module.exports = urlSetQuery\nfunction urlSetQuery (url, query) {\n  if (query) {\n    // remove optional leading symbols\n    query = query.trim().replace(/^(\\?|#|&)/, '')\n\n    // don't append empty query\n    query = query ? ('?' + query) : query\n\n    var parts = url.split(/[\\?\\#]/)\n    var start = parts[0]\n    if (query && /\\:\\/\\/[^\\/]*$/.test(start)) {\n      // e.g. http://foo.com -> http://foo.com/\n      start = start + '/'\n    }\n    var match = url.match(/(\\#.*)$/)\n    url = start + query\n    if (match) { // add hash back in\n      url = url + match[0]\n    }\n  }\n  return url\n}\n","var queryString = require('query-string')\nvar setQuery = require('url-set-query')\nvar assign = require('object-assign')\nvar ensureHeader = require('./lib/ensure-header.js')\n\n// this is replaced in the browser\nvar request = require('./lib/request.js')\n\nvar mimeTypeJson = 'application/json'\nvar noop = function () {}\n\nmodule.exports = xhrRequest\nfunction xhrRequest (url, opt, cb) {\n  if (!url || typeof url !== 'string') {\n    throw new TypeError('must specify a URL')\n  }\n  if (typeof opt === 'function') {\n    cb = opt\n    opt = {}\n  }\n  if (cb && typeof cb !== 'function') {\n    throw new TypeError('expected cb to be undefined or a function')\n  }\n\n  cb = cb || noop\n  opt = opt || {}\n\n  var defaultResponse = opt.json ? 'json' : 'text'\n  opt = assign({ responseType: defaultResponse }, opt)\n\n  var headers = opt.headers || {}\n  var method = (opt.method || 'GET').toUpperCase()\n  var query = opt.query\n  if (query) {\n    if (typeof query !== 'string') {\n      query = queryString.stringify(query)\n    }\n    url = setQuery(url, query)\n  }\n\n  // allow json response\n  if (opt.responseType === 'json') {\n    ensureHeader(headers, 'Accept', mimeTypeJson)\n  }\n\n  // if body content is json\n  if (opt.json && method !== 'GET' && method !== 'HEAD') {\n    ensureHeader(headers, 'Content-Type', mimeTypeJson)\n    opt.body = JSON.stringify(opt.body)\n  }\n\n  opt.method = method\n  opt.url = url\n  opt.headers = headers\n  delete opt.query\n  delete opt.json\n\n  return request(opt, cb)\n}\n","module.exports = ensureHeader\nfunction ensureHeader (headers, key, value) {\n  var lower = key.toLowerCase()\n  if (!headers[key] && !headers[lower]) {\n    headers[key] = value\n  }\n}\n","module.exports = getResponse\nfunction getResponse (opt, resp) {\n  if (!resp) return null\n  return {\n    statusCode: resp.statusCode,\n    headers: resp.headers,\n    method: opt.method,\n    url: opt.url,\n    // the XHR object in browser, http response in Node\n    rawRequest: resp.rawRequest ? resp.rawRequest : resp\n  }\n}\n","var xhr = require('xhr')\nvar normalize = require('./normalize-response')\n\nmodule.exports = xhrRequest\nfunction xhrRequest (opt, cb) {\n  delete opt.uri\n\n  // for better JSON.parse error handling than xhr module\n  var useJson = false\n  if (opt.responseType === 'json') {\n    opt.responseType = 'text'\n    useJson = true\n  }\n\n  return xhr(opt, function xhrRequestResult (err, resp, body) {\n    if (useJson && !err) {\n      try {\n        var text = resp.rawRequest.responseText\n        body = JSON.parse(text)\n      } catch (e) {\n        err = e\n      }\n    }\n\n    resp = normalize(opt, resp)\n    if (err) cb(err, null, resp)\n    else cb(err, body, resp)\n  })\n}\n","\"use strict\";\nvar window = require(\"global/window\")\nvar isFunction = require(\"is-function\")\nvar parseHeaders = require(\"parse-headers\")\nvar xtend = require(\"xtend\")\n\nmodule.exports = createXHR\ncreateXHR.XMLHttpRequest = window.XMLHttpRequest || noop\ncreateXHR.XDomainRequest = \"withCredentials\" in (new createXHR.XMLHttpRequest()) ? createXHR.XMLHttpRequest : window.XDomainRequest\n\nforEachArray([\"get\", \"put\", \"post\", \"patch\", \"head\", \"delete\"], function(method) {\n    createXHR[method === \"delete\" ? \"del\" : method] = function(uri, options, callback) {\n        options = initParams(uri, options, callback)\n        options.method = method.toUpperCase()\n        return _createXHR(options)\n    }\n})\n\nfunction forEachArray(array, iterator) {\n    for (var i = 0; i < array.length; i++) {\n        iterator(array[i])\n    }\n}\n\nfunction isEmpty(obj){\n    for(var i in obj){\n        if(obj.hasOwnProperty(i)) return false\n    }\n    return true\n}\n\nfunction initParams(uri, options, callback) {\n    var params = uri\n\n    if (isFunction(options)) {\n        callback = options\n        if (typeof uri === \"string\") {\n            params = {uri:uri}\n        }\n    } else {\n        params = xtend(options, {uri: uri})\n    }\n\n    params.callback = callback\n    return params\n}\n\nfunction createXHR(uri, options, callback) {\n    options = initParams(uri, options, callback)\n    return _createXHR(options)\n}\n\nfunction _createXHR(options) {\n    if(typeof options.callback === \"undefined\"){\n        throw new Error(\"callback argument missing\")\n    }\n\n    var called = false\n    var callback = function cbOnce(err, response, body){\n        if(!called){\n            called = true\n            options.callback(err, response, body)\n        }\n    }\n\n    function readystatechange() {\n        if (xhr.readyState === 4) {\n            loadFunc()\n        }\n    }\n\n    function getBody() {\n        // Chrome with requestType=blob throws errors arround when even testing access to responseText\n        var body = undefined\n\n        if (xhr.response) {\n            body = xhr.response\n        } else {\n            body = xhr.responseText || getXml(xhr)\n        }\n\n        if (isJson) {\n            try {\n                body = JSON.parse(body)\n            } catch (e) {}\n        }\n\n        return body\n    }\n\n    var failureResponse = {\n                body: undefined,\n                headers: {},\n                statusCode: 0,\n                method: method,\n                url: uri,\n                rawRequest: xhr\n            }\n\n    function errorFunc(evt) {\n        clearTimeout(timeoutTimer)\n        if(!(evt instanceof Error)){\n            evt = new Error(\"\" + (evt || \"Unknown XMLHttpRequest Error\") )\n        }\n        evt.statusCode = 0\n        return callback(evt, failureResponse)\n    }\n\n    // will load the data & process the response in a special response object\n    function loadFunc() {\n        if (aborted) return\n        var status\n        clearTimeout(timeoutTimer)\n        if(options.useXDR && xhr.status===undefined) {\n            //IE8 CORS GET successful response doesn't have a status field, but body is fine\n            status = 200\n        } else {\n            status = (xhr.status === 1223 ? 204 : xhr.status)\n        }\n        var response = failureResponse\n        var err = null\n\n        if (status !== 0){\n            response = {\n                body: getBody(),\n                statusCode: status,\n                method: method,\n                headers: {},\n                url: uri,\n                rawRequest: xhr\n            }\n            if(xhr.getAllResponseHeaders){ //remember xhr can in fact be XDR for CORS in IE\n                response.headers = parseHeaders(xhr.getAllResponseHeaders())\n            }\n        } else {\n            err = new Error(\"Internal XMLHttpRequest Error\")\n        }\n        return callback(err, response, response.body)\n    }\n\n    var xhr = options.xhr || null\n\n    if (!xhr) {\n        if (options.cors || options.useXDR) {\n            xhr = new createXHR.XDomainRequest()\n        }else{\n            xhr = new createXHR.XMLHttpRequest()\n        }\n    }\n\n    var key\n    var aborted\n    var uri = xhr.url = options.uri || options.url\n    var method = xhr.method = options.method || \"GET\"\n    var body = options.body || options.data || null\n    var headers = xhr.headers = options.headers || {}\n    var sync = !!options.sync\n    var isJson = false\n    var timeoutTimer\n\n    if (\"json\" in options) {\n        isJson = true\n        headers[\"accept\"] || headers[\"Accept\"] || (headers[\"Accept\"] = \"application/json\") //Don't override existing accept header declared by user\n        if (method !== \"GET\" && method !== \"HEAD\") {\n            headers[\"content-type\"] || headers[\"Content-Type\"] || (headers[\"Content-Type\"] = \"application/json\") //Don't override existing accept header declared by user\n            body = JSON.stringify(options.json)\n        }\n    }\n\n    xhr.onreadystatechange = readystatechange\n    xhr.onload = loadFunc\n    xhr.onerror = errorFunc\n    // IE9 must have onprogress be set to a unique function.\n    xhr.onprogress = function () {\n        // IE must die\n    }\n    xhr.ontimeout = errorFunc\n    xhr.open(method, uri, !sync, options.username, options.password)\n    //has to be after open\n    if(!sync) {\n        xhr.withCredentials = !!options.withCredentials\n    }\n    // Cannot set timeout with sync request\n    // not setting timeout on the xhr object, because of old webkits etc. not handling that correctly\n    // both npm's request and jquery 1.x use this kind of timeout, so this is being consistent\n    if (!sync && options.timeout > 0 ) {\n        timeoutTimer = setTimeout(function(){\n            aborted=true//IE9 may still call readystatechange\n            xhr.abort(\"timeout\")\n            var e = new Error(\"XMLHttpRequest timeout\")\n            e.code = \"ETIMEDOUT\"\n            errorFunc(e)\n        }, options.timeout )\n    }\n\n    if (xhr.setRequestHeader) {\n        for(key in headers){\n            if(headers.hasOwnProperty(key)){\n                xhr.setRequestHeader(key, headers[key])\n            }\n        }\n    } else if (options.headers && !isEmpty(options.headers)) {\n        throw new Error(\"Headers cannot be set on an XDomainRequest object\")\n    }\n\n    if (\"responseType\" in options) {\n        xhr.responseType = options.responseType\n    }\n\n    if (\"beforeSend\" in options &&\n        typeof options.beforeSend === \"function\"\n    ) {\n        options.beforeSend(xhr)\n    }\n\n    xhr.send(body)\n\n    return xhr\n\n\n}\n\nfunction getXml(xhr) {\n    if (xhr.responseType === \"document\") {\n        return xhr.responseXML\n    }\n    var firefoxBugTakenEffect = xhr.status === 204 && xhr.responseXML && xhr.responseXML.documentElement.nodeName === \"parsererror\"\n    if (xhr.responseType === \"\" && !firefoxBugTakenEffect) {\n        return xhr.responseXML\n    }\n\n    return null\n}\n\nfunction noop() {}\n","module.exports = extend\n\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\n\nfunction extend() {\n    var target = {}\n\n    for (var i = 0; i < arguments.length; i++) {\n        var source = arguments[i]\n\n        for (var key in source) {\n            if (hasOwnProperty.call(source, key)) {\n                target[key] = source[key]\n            }\n        }\n    }\n\n    return target\n}\n"]}