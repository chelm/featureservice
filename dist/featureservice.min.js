(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.FeatureService = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
function singlePage(e,r){return[{req:[e,"/",r,"/query?where=1=1&returnGeometry=true&outFields=*&outSR=4326&f=json"].join("")}]}function findMinAndMax(e){var r=e.features[0].attributes,t=Object.keys(r).map(function(e){return r[e]}),o={};return o.min=t[0]<t[1]?t[0]:t[1],o.max=t[1]>t[0]?t[1]:t[0],o}var queue=require("async").queue,Utils=require("./lib/utils.js"),FeatureService=function(e,r){if(!(this instanceof FeatureService))return new FeatureService(e,r);var t=Utils.parseUrl(e);this.hosted=t.hosted,this.server=t.server,this.options=r||{},(this.options.layer||0===this.options.layer)&&(this.options.layer=Utils.sanitizeLayer(this.options.layer)),this.options.size=this.options.size||5e3,this.options.backoff=this.options.backoff||1e3,this.options.timeOut=this.options.timeOut||9e4,this.layer=this.options.layer||t.layer||0,this.logger=this.options.logger,this._request=require("xhr-request"),this.pageQueue=queue(this._requestFeatures.bind(this),this.options.concurrency||4)};FeatureService.prototype.log=function(e,r){return this.logger&&this.logger.log?this.logger.log(e,r):void this._console(e,r)},FeatureService.prototype._console=function(e,r){switch(e){case"info":console.info(r);break;case"warn":console.warn(r);break;case"error":console.error(r);break;default:console.log(r)}},FeatureService.prototype.request=function(e,r){var t,o=encodeURI(decodeURI(e)),i={timeout:this.options.timeOut,headers:{"user-agent":"Featureservices-Node"}};this._request(o,i,function(e,o,i){if(e)return"ESOCKETTIMEDOUT"===e.code&&(e.code=504),r(e);try{t=JSON.parse(o)}catch(e){var n=new RegExp(/[^{\[]/);return r(o.slice(0,1).match(n)?new Error("Received HTML or plain text when expecting JSON"):new Error("Failed to parse server response"))}r(null,t)})},FeatureService.prototype._statsUrl=function(e,r){e=e||this.options.objectIdField;var t=[];return r.forEach(function(r){t.push({statisticType:r,onStatisticField:e,outStatisticFieldName:r+"_"+e})}),this.server+"/"+this.layer+"/query?f=json&outFields=&outStatistics="+JSON.stringify(t)},FeatureService.prototype.statistics=function(e,r,t){var o=this._statsUrl(e,r);this.request(o,function(e,r){if(e||r.error){r||(r={error:{}});var i=new Error("Request for statistics failed");return i.timestamp=new Date,i.code=r.error.code||500,i.body=e||r.error,i.url=o,t(i)}t(null,r)})},FeatureService.prototype.info=function(e){if("undefined"==typeof e)return this._info;if(this._info)return e(null,this._info);var r=this.server+"?f=json";this.request(r,function(t,o){if(t||!o||o.error){o||(o={error:{}});var i=new Error("Request for service information failed");return i.timestamp=new Date,i.url=r,i.code=o.error.code||500,i.body=o.error,e(i)}this._info=o,o.url=r,e(null,o)})},FeatureService.prototype.layerInfo=function(e){if("undefined"==typeof e)return this._layerInfo;if(this._layerInfo)return e(null,this._layerInfo);var r=this.server+"/"+this.layer+"?f=json";this.request(r,function(t,o){if(t||!o||o.error){o||(o={error:{}});var i=new Error("Request for layer information failed");return i.timestamp=new Date,i.url=r,i.code=o.error.code||500,i.body=o.error,e(i)}o.url=r,e(null,o)})},FeatureService.prototype.getObjectIdField=function(e){var r;return!!e.fields&&(e.objectIdField?e.objectIdField:(e.fields.some(function(e){if("esriFieldTypeOID"===e.type)return r=e.name,!0}),r))},FeatureService.prototype.layerIds=function(e){var r=this.server+"/"+this.layer+"/query?where=1=1&returnIdsOnly=true&f=json";this.request(r,function(t,o){if(t||!o.objectIds){o||(o={error:{}});var i=new Error("Request for object IDs failed");return i.timestamp=new Date,i.code=o.error.code||500,i.url=r,i.body=t||o.error,e(i)}o.objectIds.sort(function(e,r){return e-r}),e(null,o.objectIds)})},FeatureService.prototype.featureCount=function(e){var r=this.server+"/"+(this.layer||0);r+="/query?where=1=1&returnCountOnly=true&f=json",this.request(r,function(t,o){if(t||o.error){o||(o={error:{}});var i=new Error("Request for feature count failed");return i.timestamp=new Date,i.code=o.error.code||500,i.url=r,i.body=t||o.error,e(i)}e(null,o)})},FeatureService.prototype.metadata=function(e){return"undefined"==typeof e?this._metadata:this._metadata?e(null,this._metadata):void this.layerInfo(function(r,t){if(r)return r.message="Unable to get layer metadata: "+r.message,e(r);this._layerInfo=t;var o=this.getObjectIdField(t),i=t.maxRecordCount,n={layer:t,oid:o,size:i};return t.currentVersion?void this.featureCount(function(r,t){return r?e(r):t.count<1?e(new Error("Service returned count of 0")):(n.count=t.count,this._metadata=n,void e(null,n))}):e(null,n)}.bind(this))},FeatureService.prototype.pages=function(e){this.metadata(function(r,t){if(r)return e(r);if(t.count<t.layer.maxRecordCount&&t.count<this.options.size)return e(null,singlePage(this.server,this.layer));this.concurrency=this.options.concurrency||Utils.setConcurrency(this.hosted,t.layer.geometryType),this.maxConcurrency=this.concurrency,this.pageQueue.concurrency=this.concurrency;var o=Math.min(parseInt(t.size,10),1e3)||1e3;o>5e3&&(o=this.options.size);var i=t.layer,n=Math.ceil(t.count/o),s=i.advancedQueryCapabilities&&i.advancedQueryCapabilities.supportsPagination;return s&&this.hosted?e(null,this._offsetPages(n,o)):t.oid?(this.options.objectIdField=t.oid,void(i.supportsStatistics?this.getObjectIdRange(t.oid,function(r,t){return r?void this.layerIds(function(r,t){return r?e(r):e(null,this._idPages(t,o))}.bind(this)):e(null,this._rangePages(t,o))}.bind(this)):this.layerIds(function(r,t){return r?e(r):void e(null,this._idPages(t,o))}.bind(this)))):e(new Error("ObjectID type field not found, unable to page"))}.bind(this))},FeatureService.prototype.getObjectIdRange=function(e,r){this.statistics(e,["min","max"],function(e,t){if(e)return r(e);var o,i="Response from statistics was invalid";try{o=findMinAndMax(t)}catch(e){return r(new Error(i))}return!o.min>0&&!o.max>0?r(new Error(i)):void r(null,o)})},FeatureService.prototype._offsetPages=function(e,r){for(var t,o=[],i=this.server,n=0;n<e;n++){t=n*r;var s=i+"/"+this.layer+"/query?outSR=4326&f=json&outFields=*&where=1=1";if(1===e)return[{req:s+"&geometry=&returnGeometry=true&geometryPrecision="}];s+="&resultOffset="+t,s+="&resultRecordCount="+r,s+="&geometry=&returnGeometry=true&geometryPrecision=",o.push({req:s})}return o},FeatureService.prototype._idPages=function(e,r){for(var t=[],o=this.options.objectIdField||"objectId",i=e.length/r,n=0;n<i+1;n++){var s=e.splice(0,r);if(s.length){var u=s[0],a=s.pop(),c=[o," >= ",u," AND ",o,"<=",a].join(""),l=this.server+"/"+this.layer+"/query?outSR=4326&where="+c+"&f=json&outFields=*";l+="&geometry=&returnGeometry=true&geometryPrecision=10",t.push({req:l})}}return t},FeatureService.prototype._rangePages=function(e,r){for(var t,o,i,n,s=[],u=this.options.objectIdField,a=this.server,c=Math.max(e.max===r?e.max:Math.ceil((e.max-e.min)/r),1),l=0;l<c;l++)o=l===c-1?e.max:e.min+r*(l+1)-1,i=e.min+r*l,n=[u,">=",i,"+AND+",u,"<=",o].join(""),t=a+"/"+(this.layer||0)+"/query?outSR=4326&where="+n+"&f=json&outFields=*",t+="&geometry=&returnGeometry=true&geometryPrecision=",s.push({req:t});return s},FeatureService.prototype._requestFeatures=function(e,r){var t=this;this.request(e.req,function(o,i){if(o)return t._catchErrors(e,o,e.req,r);if(!i||i.error){i||(i={error:{}});var n=new Error("Request for a page of features failed");return n.timestamp=new Date,n.body=i.error,n.code=i.error.code||500,t._catchErrors(e,n,e.req,r)}t._throttleQueue(),r(null,i)})},FeatureService.prototype._catchErrors=function(e,r,t,o){return this._throttleQueue(r),r.body=r.body||{},r.code||(r.code=r.body.code),r.url=t,e.retry&&3===e.retry?this._abortPaging(r,o):(e.retry?e.retry++:e.retry=1,this.log("info","Re-requesting page "+e.req+" attempt "+e.retry),void setTimeout(function(){this._requestFeatures(e,o)}.bind(this),e.retry*this.options.backoff))},FeatureService.prototype._throttleQueue=function(e){e?this.concurrency-=.5:this.concurrency+=.1,this.concurrency>this.maxConcurrency&&(this.concurrency=this.maxConcurrency),this.pageQueue.concurrency=this.concurrency>=1?Math.floor(this.concurrency):1},FeatureService.prototype._abortPaging=function(e,r){this.pageQueue.kill(),e.message="Paging aborted: "+e.message,r(e)},module.exports=FeatureService;
},{"./lib/utils.js":2,"async":3,"xhr-request":14}],2:[function(require,module,exports){
module.exports={setConcurrency:function(r,e){var t=r?16:4;if(!e)return t;var a=e.match(/point/i)?t:t/4;return Math.floor(a)},parseUrl:function(r){var e=r.match(/(?:.+\/(?:feature|map)server\/)(\d+)/i);return{layer:e&&e[1]?e[1]:void 0,server:r.match(/.+\/(feature|map)server/i)[0],hosted:/services(\d)?(qa|dev)?.arcgis.com/.test(r)}},sanitizeLayer:function(r){if("number"==typeof r)return r;if("string"==typeof r){var e=r.match(/\/?(\d+)/);return e&&e[1]?e[1]:void 0}}};
},{}],3:[function(require,module,exports){
(function (process,global){
!function(){function n(){}function t(n){return n}function e(n){return!!n}function r(n){return!n}function u(n){return function(){if(null===n)throw new Error("Callback was already called.");n.apply(this,arguments),n=null}}function i(n){return function(){null!==n&&(n.apply(this,arguments),n=null)}}function o(n){return M(n)||"number"==typeof n.length&&n.length>=0&&n.length%1===0}function c(n,t){for(var e=-1,r=n.length;++e<r;)t(n[e],e,n)}function f(n,t){for(var e=-1,r=n.length,u=Array(r);++e<r;)u[e]=t(n[e],e,n);return u}function a(n){return f(Array(n),function(n,t){return t})}function l(n,t,e){return c(n,function(n,r,u){e=t(e,n,r,u)}),e}function s(n,t){c(W(n),function(e){t(n[e],e)})}function p(n,t){for(var e=0;e<n.length;e++)if(n[e]===t)return e;return-1}function h(n){var t,e,r=-1;return o(n)?(t=n.length,function(){return r++,r<t?r:null}):(e=W(n),t=e.length,function(){return r++,r<t?e[r]:null})}function y(n,t){return t=null==t?n.length-1:+t,function(){for(var e=Math.max(arguments.length-t,0),r=Array(e),u=0;u<e;u++)r[u]=arguments[u+t];switch(t){case 0:return n.call(this,r);case 1:return n.call(this,arguments[0],r)}}}function m(n){return function(t,e,r){return n(t,r)}}function v(t){return function(e,r,o){o=i(o||n),e=e||[];var c=h(e);if(t<=0)return o(null);var f=!1,a=0,l=!1;!function n(){if(f&&a<=0)return o(null);for(;a<t&&!l;){var i=c();if(null===i)return f=!0,void(a<=0&&o(null));a+=1,r(e[i],i,u(function(t){a-=1,t?(o(t),l=!0):n()}))}}()}}function d(n){return function(t,e,r){return n(P.eachOf,t,e,r)}}function g(n){return function(t,e,r,u){return n(v(e),t,r,u)}}function k(n){return function(t,e,r){return n(P.eachOfSeries,t,e,r)}}function b(t,e,r,u){u=i(u||n),e=e||[];var c=o(e)?[]:{};t(e,function(n,t,e){r(n,function(n,r){c[t]=r,e(n)})},function(n){u(n,c)})}function w(n,t,e,r){var u=[];n(t,function(n,t,r){e(n,function(e){e&&u.push({index:t,value:n}),r()})},function(){r(f(u.sort(function(n,t){return n.index-t.index}),function(n){return n.value}))})}function O(n,t,e,r){w(n,t,function(n,t){e(n,function(n){t(!n)})},r)}function S(n,t,e){return function(r,u,i,o){function c(){o&&o(e(!1,void 0))}function f(n,r,u){return o?void i(n,function(r){o&&t(r)&&(o(e(!0,n)),o=i=!1),u()}):u()}arguments.length>3?n(r,u,f,c):(o=i,i=u,n(r,f,c))}}function E(n,t){return t}function L(t,e,r){r=r||n;var u=o(e)?[]:{};t(e,function(n,t,e){n(y(function(n,r){r.length<=1&&(r=r[0]),u[t]=r,e(n)}))},function(n){r(n,u)})}function j(n,t,e,r){var u=[];n(t,function(n,t,r){e(n,function(n,t){u=u.concat(t||[]),r(n)})},function(n){r(n,u)})}function I(t,e,r){function i(t,e,r,u){if(null!=u&&"function"!=typeof u)throw new Error("task callback must be a function");return t.started=!0,M(e)||(e=[e]),0===e.length&&t.idle()?P.setImmediate(function(){t.drain()}):(c(e,function(e){var i={data:e,callback:u||n};r?t.tasks.unshift(i):t.tasks.push(i),t.tasks.length===t.concurrency&&t.saturated()}),void P.setImmediate(t.process))}function o(n,t){return function(){a-=1;var e=!1,r=arguments;c(t,function(n){c(l,function(t,r){t!==n||e||(l.splice(r,1),e=!0)}),n.callback.apply(n,r)}),n.tasks.length+a===0&&n.drain(),n.process()}}if(null==e)e=1;else if(0===e)throw new Error("Concurrency must not be zero");var a=0,l=[],s={tasks:[],concurrency:e,payload:r,saturated:n,empty:n,drain:n,started:!1,paused:!1,push:function(n,t){i(s,n,!1,t)},kill:function(){s.drain=n,s.tasks=[]},unshift:function(n,t){i(s,n,!0,t)},process:function(){for(;!s.paused&&a<s.concurrency&&s.tasks.length;){var n=s.payload?s.tasks.splice(0,s.payload):s.tasks.splice(0,s.tasks.length),e=f(n,function(n){return n.data});0===s.tasks.length&&s.empty(),a+=1,l.push(n[0]);var r=u(o(s,n));t(e,r)}},length:function(){return s.tasks.length},running:function(){return a},workersList:function(){return l},idle:function(){return s.tasks.length+a===0},pause:function(){s.paused=!0},resume:function(){if(s.paused!==!1){s.paused=!1;for(var n=Math.min(s.concurrency,s.tasks.length),t=1;t<=n;t++)P.setImmediate(s.process)}}};return s}function x(n){return y(function(t,e){t.apply(null,e.concat([y(function(t,e){"object"==typeof console&&(t?console.error&&console.error(t):console[n]&&c(e,function(t){console[n](t)}))})]))})}function A(n){return function(t,e,r){n(a(t),e,r)}}function T(n){return y(function(t,e){var r=y(function(e){var r=this,u=e.pop();return n(t,function(n,t,u){n.apply(r,e.concat([u]))},u)});return e.length?r.apply(this,e):r})}function z(n){return y(function(t){var e=t.pop();t.push(function(){var n=arguments;r?P.setImmediate(function(){e.apply(null,n)}):e.apply(null,n)});var r=!0;n.apply(this,t),r=!1})}var q,P={},C="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||this;null!=C&&(q=C.async),P.noConflict=function(){return C.async=q,P};var H=Object.prototype.toString,M=Array.isArray||function(n){return"[object Array]"===H.call(n)},U=function(n){var t=typeof n;return"function"===t||"object"===t&&!!n},W=Object.keys||function(n){var t=[];for(var e in n)n.hasOwnProperty(e)&&t.push(e);return t},B="function"==typeof setImmediate&&setImmediate,D=B?function(n){B(n)}:function(n){setTimeout(n,0)};"object"==typeof process&&"function"==typeof process.nextTick?P.nextTick=process.nextTick:P.nextTick=D,P.setImmediate=B?D:P.nextTick,P.forEach=P.each=function(n,t,e){return P.eachOf(n,m(t),e)},P.forEachSeries=P.eachSeries=function(n,t,e){return P.eachOfSeries(n,m(t),e)},P.forEachLimit=P.eachLimit=function(n,t,e,r){return v(t)(n,m(e),r)},P.forEachOf=P.eachOf=function(t,e,r){function o(n){a--,n?r(n):null===c&&a<=0&&r(null)}r=i(r||n),t=t||[];for(var c,f=h(t),a=0;null!=(c=f());)a+=1,e(t[c],c,u(o));0===a&&r(null)},P.forEachOfSeries=P.eachOfSeries=function(t,e,r){function o(){var n=!0;return null===f?r(null):(e(t[f],f,u(function(t){if(t)r(t);else{if(f=c(),null===f)return r(null);n?P.setImmediate(o):o()}})),void(n=!1))}r=i(r||n),t=t||[];var c=h(t),f=c();o()},P.forEachOfLimit=P.eachOfLimit=function(n,t,e,r){v(t)(n,e,r)},P.map=d(b),P.mapSeries=k(b),P.mapLimit=g(b),P.inject=P.foldl=P.reduce=function(n,t,e,r){P.eachOfSeries(n,function(n,r,u){e(t,n,function(n,e){t=e,u(n)})},function(n){r(n,t)})},P.foldr=P.reduceRight=function(n,e,r,u){var i=f(n,t).reverse();P.reduce(i,e,r,u)},P.transform=function(n,t,e,r){3===arguments.length&&(r=e,e=t,t=M(n)?[]:{}),P.eachOf(n,function(n,r,u){e(t,n,r,u)},function(n){r(n,t)})},P.select=P.filter=d(w),P.selectLimit=P.filterLimit=g(w),P.selectSeries=P.filterSeries=k(w),P.reject=d(O),P.rejectLimit=g(O),P.rejectSeries=k(O),P.any=P.some=S(P.eachOf,e,t),P.someLimit=S(P.eachOfLimit,e,t),P.all=P.every=S(P.eachOf,r,r),P.everyLimit=S(P.eachOfLimit,r,r),P.detect=S(P.eachOf,t,E),P.detectSeries=S(P.eachOfSeries,t,E),P.detectLimit=S(P.eachOfLimit,t,E),P.sortBy=function(n,t,e){function r(n,t){var e=n.criteria,r=t.criteria;return e<r?-1:e>r?1:0}P.map(n,function(n,e){t(n,function(t,r){t?e(t):e(null,{value:n,criteria:r})})},function(n,t){return n?e(n):void e(null,f(t.sort(r),function(n){return n.value}))})},P.auto=function(t,e,r){function u(n){g.unshift(n)}function o(n){var t=p(g,n);t>=0&&g.splice(t,1)}function f(){h--,c(g.slice(0),function(n){n()})}"function"==typeof arguments[1]&&(r=e,e=null),r=i(r||n);var a=W(t),h=a.length;if(!h)return r(null);e||(e=h);var m={},v=0,d=!1,g=[];u(function(){h||r(null,m)}),c(a,function(n){function i(){return v<e&&l(k,function(n,t){return n&&m.hasOwnProperty(t)},!0)&&!m.hasOwnProperty(n)}function c(){i()&&(v++,o(c),h[h.length-1](g,m))}if(!d){for(var a,h=M(t[n])?t[n]:[t[n]],g=y(function(t,e){if(v--,e.length<=1&&(e=e[0]),t){var u={};s(m,function(n,t){u[t]=n}),u[n]=e,d=!0,r(t,u)}else m[n]=e,P.setImmediate(f)}),k=h.slice(0,h.length-1),b=k.length;b--;){if(!(a=t[k[b]]))throw new Error("Has nonexistent dependency in "+k.join(", "));if(M(a)&&p(a,n)>=0)throw new Error("Has cyclic dependencies")}i()?(v++,h[h.length-1](g,m)):u(c)}})},P.retry=function(n,t,e){function r(n,t){if("number"==typeof t)n.times=parseInt(t,10)||i;else{if("object"!=typeof t)throw new Error("Unsupported argument type for 'times': "+typeof t);n.times=parseInt(t.times,10)||i,n.interval=parseInt(t.interval,10)||o}}function u(n,t){function e(n,e){return function(r){n(function(n,t){r(!n||e,{err:n,result:t})},t)}}function r(n){return function(t){setTimeout(function(){t(null)},n)}}for(;f.times;){var u=!(f.times-=1);c.push(e(f.task,u)),!u&&f.interval>0&&c.push(r(f.interval))}P.series(c,function(t,e){e=e[e.length-1],(n||f.callback)(e.err,e.result)})}var i=5,o=0,c=[],f={times:i,interval:o},a=arguments.length;if(a<1||a>3)throw new Error("Invalid arguments - must be either (task), (task, callback), (times, task) or (times, task, callback)");return a<=2&&"function"==typeof n&&(e=t,t=n),"function"!=typeof n&&r(f,n),f.callback=e,f.task=t,f.callback?u():u},P.waterfall=function(t,e){function r(n){return y(function(t,u){if(t)e.apply(null,[t].concat(u));else{var i=n.next();i?u.push(r(i)):u.push(e),z(n).apply(null,u)}})}if(e=i(e||n),!M(t)){var u=new Error("First argument to waterfall must be an array of functions");return e(u)}return t.length?void r(P.iterator(t))():e()},P.parallel=function(n,t){L(P.eachOf,n,t)},P.parallelLimit=function(n,t,e){L(v(t),n,e)},P.series=function(n,t){L(P.eachOfSeries,n,t)},P.iterator=function(n){function t(e){function r(){return n.length&&n[e].apply(null,arguments),r.next()}return r.next=function(){return e<n.length-1?t(e+1):null},r}return t(0)},P.apply=y(function(n,t){return y(function(e){return n.apply(null,t.concat(e))})}),P.concat=d(j),P.concatSeries=k(j),P.whilst=function(t,e,r){if(r=r||n,t()){var u=y(function(n,i){n?r(n):t.apply(this,i)?e(u):r.apply(null,[null].concat(i))});e(u)}else r(null)},P.doWhilst=function(n,t,e){var r=0;return P.whilst(function(){return++r<=1||t.apply(this,arguments)},n,e)},P.until=function(n,t,e){return P.whilst(function(){return!n.apply(this,arguments)},t,e)},P.doUntil=function(n,t,e){return P.doWhilst(n,function(){return!t.apply(this,arguments)},e)},P.during=function(t,e,r){r=r||n;var u=y(function(n,e){n?r(n):(e.push(i),t.apply(this,e))}),i=function(n,t){n?r(n):t?e(u):r(null)};t(i)},P.doDuring=function(n,t,e){var r=0;P.during(function(n){r++<1?n(null,!0):t.apply(this,arguments)},n,e)},P.queue=function(n,t){var e=I(function(t,e){n(t[0],e)},t,1);return e},P.priorityQueue=function(t,e){function r(n,t){return n.priority-t.priority}function u(n,t,e){for(var r=-1,u=n.length-1;r<u;){var i=r+(u-r+1>>>1);e(t,n[i])>=0?r=i:u=i-1}return r}function i(t,e,i,o){if(null!=o&&"function"!=typeof o)throw new Error("task callback must be a function");return t.started=!0,M(e)||(e=[e]),0===e.length?P.setImmediate(function(){t.drain()}):void c(e,function(e){var c={data:e,priority:i,callback:"function"==typeof o?o:n};t.tasks.splice(u(t.tasks,c,r)+1,0,c),t.tasks.length===t.concurrency&&t.saturated(),P.setImmediate(t.process)})}var o=P.queue(t,e);return o.push=function(n,t,e){i(o,n,t,e)},delete o.unshift,o},P.cargo=function(n,t){return I(n,1,t)},P.log=x("log"),P.dir=x("dir"),P.memoize=function(n,e){var r={},u={},i=Object.prototype.hasOwnProperty;e=e||t;var o=y(function(t){var o=t.pop(),c=e.apply(null,t);i.call(r,c)?P.setImmediate(function(){o.apply(null,r[c])}):i.call(u,c)?u[c].push(o):(u[c]=[o],n.apply(null,t.concat([y(function(n){r[c]=n;var t=u[c];delete u[c];for(var e=0,i=t.length;e<i;e++)t[e].apply(null,n)})])))});return o.memo=r,o.unmemoized=n,o},P.unmemoize=function(n){return function(){return(n.unmemoized||n).apply(null,arguments)}},P.times=A(P.map),P.timesSeries=A(P.mapSeries),P.timesLimit=function(n,t,e,r){return P.mapLimit(a(n),t,e,r)},P.seq=function(){var t=arguments;return y(function(e){var r=this,u=e[e.length-1];"function"==typeof u?e.pop():u=n,P.reduce(t,e,function(n,t,e){t.apply(r,n.concat([y(function(n,t){e(n,t)})]))},function(n,t){u.apply(r,[n].concat(t))})})},P.compose=function(){return P.seq.apply(null,Array.prototype.reverse.call(arguments))},P.applyEach=T(P.eachOf),P.applyEachSeries=T(P.eachOfSeries),P.forever=function(t,e){function r(n){return n?i(n):void o(r)}var i=u(e||n),o=z(t);r()},P.ensureAsync=z,P.constant=y(function(n){var t=[null].concat(n);return function(n){return n.apply(this,t)}}),P.wrapSync=P.asyncify=function(n){return y(function(t){var e,r=t.pop();try{e=n.apply(this,t)}catch(n){return r(n)}U(e)&&"function"==typeof e.then?e.then(function(n){r(null,n)}).catch(function(n){r(n.message?n:new Error(n))}):r(null,e)})},"object"==typeof module&&module.exports?module.exports=P:"function"==typeof define&&define.amd?define([],function(){return P}):C.async=P}();
}).call(this,require('_process'),typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"_process":4}],4:[function(require,module,exports){
function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(e){if(cachedSetTimeout===setTimeout)return setTimeout(e,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(e,0);try{return cachedSetTimeout(e,0)}catch(t){try{return cachedSetTimeout.call(null,e,0)}catch(t){return cachedSetTimeout.call(this,e,0)}}}function runClearTimeout(e){if(cachedClearTimeout===clearTimeout)return clearTimeout(e);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(e);try{return cachedClearTimeout(e)}catch(t){try{return cachedClearTimeout.call(null,e)}catch(t){return cachedClearTimeout.call(this,e)}}}function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var e=runTimeout(cleanUpNextTick);draining=!0;for(var t=queue.length;t;){for(currentQueue=queue,queue=[];++queueIndex<t;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,t=queue.length}currentQueue=null,draining=!1,runClearTimeout(e)}}function Item(e,t){this.fun=e,this.array=t}function noop(){}var process=module.exports={},cachedSetTimeout,cachedClearTimeout;!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var queue=[],draining=!1,currentQueue,queueIndex=-1;process.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var u=1;u<arguments.length;u++)t[u-1]=arguments[u];queue.push(new Item(e,t)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.binding=function(e){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(e){throw new Error("process.chdir is not supported")},process.umask=function(){return 0};
},{}],5:[function(require,module,exports){
function forEach(r,t,o){if(!isFunction(t))throw new TypeError("iterator must be a function");arguments.length<3&&(o=this),"[object Array]"===toString.call(r)?forEachArray(r,t,o):"string"==typeof r?forEachString(r,t,o):forEachObject(r,t,o)}function forEachArray(r,t,o){for(var n=0,a=r.length;n<a;n++)hasOwnProperty.call(r,n)&&t.call(o,r[n],n,r)}function forEachString(r,t,o){for(var n=0,a=r.length;n<a;n++)t.call(o,r.charAt(n),n,r)}function forEachObject(r,t,o){for(var n in r)hasOwnProperty.call(r,n)&&t.call(o,r[n],n,r)}var isFunction=require("is-function");module.exports=forEach;var toString=Object.prototype.toString,hasOwnProperty=Object.prototype.hasOwnProperty;
},{"is-function":7}],6:[function(require,module,exports){
(function (global){
"undefined"!=typeof window?module.exports=window:"undefined"!=typeof global?module.exports=global:"undefined"!=typeof self?module.exports=self:module.exports={};
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],7:[function(require,module,exports){
function isFunction(o){var t=toString.call(o);return"[object Function]"===t||"function"==typeof o&&"[object RegExp]"!==t||"undefined"!=typeof window&&(o===window.setTimeout||o===window.alert||o===window.confirm||o===window.prompt)}module.exports=isFunction;var toString=Object.prototype.toString;
},{}],8:[function(require,module,exports){
"use strict";function ToObject(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}function ownEnumerableKeys(e){var r=Object.getOwnPropertyNames(e);return Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(e))),r.filter(function(r){return propIsEnumerable.call(e,r)})}var propIsEnumerable=Object.prototype.propertyIsEnumerable;module.exports=Object.assign||function(e,r){for(var t,n,o=ToObject(e),c=1;c<arguments.length;c++){t=arguments[c],n=ownEnumerableKeys(Object(t));for(var l=0;l<n.length;l++)o[n[l]]=t[n[l]]}return o};
},{}],9:[function(require,module,exports){
var trim=require("trim"),forEach=require("for-each"),isArray=function(r){return"[object Array]"===Object.prototype.toString.call(r)};module.exports=function(r){if(!r)return{};var e={};return forEach(trim(r).split("\n"),function(r){var t=r.indexOf(":"),i=trim(r.slice(0,t)).toLowerCase(),o=trim(r.slice(t+1));"undefined"==typeof e[i]?e[i]=o:isArray(e[i])?e[i].push(o):e[i]=[e[i],o]}),e};
},{"for-each":5,"trim":12}],10:[function(require,module,exports){
"use strict";var strictUriEncode=require("strict-uri-encode");exports.extract=function(r){return r.split("?")[1]||""},exports.parse=function(r){return"string"!=typeof r?{}:(r=r.trim().replace(/^(\?|#|&)/,""),r?r.split("&").reduce(function(r,t){var e=t.replace(/\+/g," ").split("="),n=e.shift(),i=e.length>0?e.join("="):void 0;return n=decodeURIComponent(n),i=void 0===i?null:decodeURIComponent(i),r.hasOwnProperty(n)?Array.isArray(r[n])?r[n].push(i):r[n]=[r[n],i]:r[n]=i,r},{}):{})},exports.stringify=function(r){return r?Object.keys(r).sort().map(function(t){var e=r[t];return Array.isArray(e)?e.sort().map(function(r){return strictUriEncode(t)+"="+strictUriEncode(r)}).join("&"):strictUriEncode(t)+"="+strictUriEncode(e)}).filter(function(r){return r.length>0}).join("&"):""};
},{"strict-uri-encode":11}],11:[function(require,module,exports){
"use strict";module.exports=function(e){return encodeURIComponent(e).replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})};
},{}],12:[function(require,module,exports){
function trim(r){return r.replace(/^\s*|\s*$/g,"")}exports=module.exports=trim,exports.left=function(r){return r.replace(/^\s*/,"")},exports.right=function(r){return r.replace(/\s*$/,"")};
},{}],13:[function(require,module,exports){
function urlSetQuery(r,e){if(e){e=e.trim().replace(/^(\?|#|&)/,""),e=e?"?"+e:e;var t=r.split(/[\?\#]/),u=t[0];e&&/\:\/\/[^\/]*$/.test(u)&&(u+="/");var l=r.match(/(\#.*)$/);r=u+e,l&&(r+=l[0])}return r}module.exports=urlSetQuery;
},{}],14:[function(require,module,exports){
function xhrRequest(e,r,n){if(!e||"string"!=typeof e)throw new TypeError("must specify a URL");if("function"==typeof r&&(n=r,r={}),n&&"function"!=typeof n)throw new TypeError("expected cb to be undefined or a function");n=n||noop,r=r||{};var s=r.json?"json":"text";r=assign({responseType:s},r);var t=r.headers||{},o=(r.method||"GET").toUpperCase(),i=r.query;return i&&("string"!=typeof i&&(i=queryString.stringify(i)),e=setQuery(e,i)),"json"===r.responseType&&ensureHeader(t,"Accept",mimeTypeJson),r.json&&"GET"!==o&&"HEAD"!==o&&(ensureHeader(t,"Content-Type",mimeTypeJson),r.body=JSON.stringify(r.body)),r.method=o,r.url=e,r.headers=t,delete r.query,delete r.json,request(r,n)}var queryString=require("query-string"),setQuery=require("url-set-query"),assign=require("object-assign"),ensureHeader=require("./lib/ensure-header.js"),request=require("./lib/request.js"),mimeTypeJson="application/json",noop=function(){};module.exports=xhrRequest;
},{"./lib/ensure-header.js":15,"./lib/request.js":17,"object-assign":8,"query-string":10,"url-set-query":13}],15:[function(require,module,exports){
function ensureHeader(e,r,o){var a=r.toLowerCase();e[r]||e[a]||(e[r]=o)}module.exports=ensureHeader;
},{}],16:[function(require,module,exports){
function getResponse(e,s){return s?{statusCode:s.statusCode,headers:s.headers,method:e.method,url:e.url,rawRequest:s.rawRequest?s.rawRequest:s}:null}module.exports=getResponse;
},{}],17:[function(require,module,exports){
function xhrRequest(e,r){delete e.uri;var n=!1;return"json"===e.responseType&&(e.responseType="text",n=!0),xhr(e,function(s,t,o){if(n&&!s)try{var u=t.rawRequest.responseText;o=JSON.parse(u)}catch(e){s=e}t=normalize(e,t),s?r(s,null,t):r(s,o,t)})}var xhr=require("xhr"),normalize=require("./normalize-response");module.exports=xhrRequest;
},{"./normalize-response":16,"xhr":18}],18:[function(require,module,exports){
"use strict";function forEachArray(e,t){for(var r=0;r<e.length;r++)t(e[r])}function isEmpty(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function initParams(e,t,r){var n=e;return isFunction(t)?(r=t,"string"==typeof e&&(n={uri:e})):n=xtend(t,{uri:e}),n.callback=r,n}function createXHR(e,t,r){return t=initParams(e,t,r),_createXHR(t)}function _createXHR(e){function t(){4===u.readyState&&o()}function r(){var e=void 0;if(e=u.response?u.response:u.responseText||getXml(u),h)try{e=JSON.parse(e)}catch(e){}return e}function n(e){return clearTimeout(p),e instanceof Error||(e=new Error(""+(e||"Unknown XMLHttpRequest Error"))),e.statusCode=0,a(e,i)}function o(){if(!d){var t;clearTimeout(p),t=e.useXDR&&void 0===u.status?200:1223===u.status?204:u.status;var n=i,o=null;return 0!==t?(n={body:r(),statusCode:t,method:f,headers:{},url:l,rawRequest:u},u.getAllResponseHeaders&&(n.headers=parseHeaders(u.getAllResponseHeaders()))):o=new Error("Internal XMLHttpRequest Error"),a(o,n,n.body)}}if("undefined"==typeof e.callback)throw new Error("callback argument missing");var s=!1,a=function(t,r,n){s||(s=!0,e.callback(t,r,n))},i={body:void 0,headers:{},statusCode:0,method:f,url:l,rawRequest:u},u=e.xhr||null;u||(u=e.cors||e.useXDR?new createXHR.XDomainRequest:new createXHR.XMLHttpRequest);var c,d,p,l=u.url=e.uri||e.url,f=u.method=e.method||"GET",m=e.body||e.data||null,R=u.headers=e.headers||{},X=!!e.sync,h=!1;if("json"in e&&(h=!0,R.accept||R.Accept||(R.Accept="application/json"),"GET"!==f&&"HEAD"!==f&&(R["content-type"]||R["Content-Type"]||(R["Content-Type"]="application/json"),m=JSON.stringify(e.json))),u.onreadystatechange=t,u.onload=o,u.onerror=n,u.onprogress=function(){},u.ontimeout=n,u.open(f,l,!X,e.username,e.password),X||(u.withCredentials=!!e.withCredentials),!X&&e.timeout>0&&(p=setTimeout(function(){d=!0,u.abort("timeout");var e=new Error("XMLHttpRequest timeout");e.code="ETIMEDOUT",n(e)},e.timeout)),u.setRequestHeader)for(c in R)R.hasOwnProperty(c)&&u.setRequestHeader(c,R[c]);else if(e.headers&&!isEmpty(e.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in e&&(u.responseType=e.responseType),"beforeSend"in e&&"function"==typeof e.beforeSend&&e.beforeSend(u),u.send(m),u}function getXml(e){if("document"===e.responseType)return e.responseXML;var t=204===e.status&&e.responseXML&&"parsererror"===e.responseXML.documentElement.nodeName;return""!==e.responseType||t?null:e.responseXML}function noop(){}var window=require("global/window"),isFunction=require("is-function"),parseHeaders=require("parse-headers"),xtend=require("xtend");module.exports=createXHR,createXHR.XMLHttpRequest=window.XMLHttpRequest||noop,createXHR.XDomainRequest="withCredentials"in new createXHR.XMLHttpRequest?createXHR.XMLHttpRequest:window.XDomainRequest,forEachArray(["get","put","post","patch","head","delete"],function(e){createXHR["delete"===e?"del":e]=function(t,r,n){return r=initParams(t,r,n),r.method=e.toUpperCase(),_createXHR(r)}});
},{"global/window":6,"is-function":7,"parse-headers":9,"xtend":19}],19:[function(require,module,exports){
function extend(){for(var r={},e=0;e<arguments.length;e++){var t=arguments[e];for(var n in t)hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r}module.exports=extend;var hasOwnProperty=Object.prototype.hasOwnProperty;
},{}]},{},[1])(1)
});


//# sourceMappingURL=featureservice.map.json